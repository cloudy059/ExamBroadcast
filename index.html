<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <link rel="shortcut icon" href="./favicon.ico">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ËÄÉËØïÁÆ°ÁêÜÁ≥ªÁªü</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            color: #1d1d1f;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 20px 20px 120px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .title {
            font-size: 2.5em;
            font-weight: 700;
            color: white;
            text-shadow: 0 2px 20px rgba(0,0,0,0.25);
            margin-bottom: 10px;
            letter-spacing: -0.5px;
        }

        .control-buttons {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            background: rgba(255,255,255,0.85);
            padding: 12px 20px;
            border-radius: 25px;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.15), 0 4px 12px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.4);
            z-index: 1000;
        }

        .control-btn {
            background: rgba(255,255,255,0.9);
            color: #1d1d1f;
            border: 1px solid rgba(255,255,255,0.6);
            padding: 12px 16px;
            border-radius: 18px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.08), inset 0 1px 0 rgba(255,255,255,0.7);
            min-width: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:hover {
            background: rgba(255,255,255,0.95);
            transform: translateY(-4px) scale(1.08);
            box-shadow: 0 8px 24px rgba(0,0,0,0.15), 0 4px 12px rgba(0,0,0,0.1), inset 0 1px 0 rgba(255,255,255,0.8);
        }

        .control-btn.active {
            background: rgba(255,255,255,0.98);
            box-shadow: 0 6px 20px rgba(0,0,0,0.12), 0 3px 8px rgba(0,0,0,0.08), inset 0 1px 0 rgba(255,255,255,0.9);
            transform: translateY(-2px) scale(1.02);
        }

        .time-display {
            background: rgba(255,255,255,0.72);
            border-radius: 22px;
            padding: 25px;
            margin-bottom: 10px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.12), 0 2px 8px rgba(0,0,0,0.08), inset 0 1px 0 rgba(255,255,255,0.5);
            backdrop-filter: blur(24px) saturate(1.8);
            -webkit-backdrop-filter: blur(24px) saturate(1.8);
            border: 1px solid rgba(255,255,255,0.4);
        }

        .time-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .time-item {
            text-align: center;
            padding: 18px;
            background: rgba(255, 255, 255, 0.55);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.5);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 120px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }

        .time-item:hover {
            background: rgba(255, 255, 255, 0.7);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .time-label {
            font-size: 1.6em;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 8px;
        }

        .time-value {
            font-size: 2.5em;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .progress-single {
            margin-top: 10px;
            transition: background-image 0.3s ease;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .section {
            background: rgba(255,255,255,0.72);
            border-radius: 22px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.12), 0 2px 8px rgba(0,0,0,0.08), inset 0 1px 0 rgba(255,255,255,0.5);
            backdrop-filter: blur(24px) saturate(1.8);
            -webkit-backdrop-filter: blur(24px) saturate(1.8);
            border: 1px solid rgba(255,255,255,0.4);
            transition: all 0.3s ease;
        }

        .section:hover {
            box-shadow: 0 12px 40px rgba(0,0,0,0.15), 0 4px 12px rgba(0,0,0,0.1), inset 0 1px 0 rgba(255,255,255,0.6);
        }

        .section-title {
            font-size: 1.4em;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            margin: 2px;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.85em;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
        }

        .btn-danger:hover {
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
            box-shadow: 0 4px 12px rgba(81, 207, 102, 0.3);
        }

        .btn-success:hover {
            box-shadow: 0 6px 20px rgba(81, 207, 102, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffd43b 0%, #fab005 100%);
            box-shadow: 0 4px 12px rgba(255, 212, 59, 0.3);
        }

        .btn-warning:hover {
            box-shadow: 0 6px 20px rgba(255, 212, 59, 0.4);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .exam-item, .reminder-item {
            background: rgba(255, 255, 255, 0.55);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 16px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: move;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }

        .exam-item:hover, .reminder-item:hover {
            border-color: rgba(102, 126, 234, 0.3);
            transform: translateY(-3px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
        }

        .exam-item.dragging, .reminder-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .item-title {
            font-weight: bold;
            font-size: 1.1em;
            color: #333;
        }

        .item-details {
            color: #666;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .status-upcoming {
            background: #e3f2fd;
            color: #1976d2;
        }

        .status-ongoing {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .status-finished {
            background: #fce4ec;
            color: #c2185b;
        }

        .controls {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1003;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: rgba(255, 255, 255, 0.92);
            margin: 5% auto;
            padding: 30px;
            border-radius: 22px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2), 0 8px 32px rgba(0,0,0,0.15);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.4);
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .audio-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .file-input {
            display: none;
        }

        .file-label {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .file-label:hover {
            transform: translateY(-2px);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }

        .import-export {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4caf50;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 1001;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background: #f44336;
        }

        .seating-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4caf50;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 1002;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .seating-notification.show {
            transform: translateX(0);
        }

        .seating-notification.error {
            background: #f44336;
        }

        .seating-notification.warning {
            background: #ff9800;
        }

        .drag-over {
            border-color: #667eea !important;
        }

        .dragging {
            background: rgba(103, 126, 234, 0.1) !important;
        }

        /* Â§úÈó¥Ê®°ÂºèÊ†∑Âºè */
        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #2d2d5a 25%, #4a3f6b 50%, #2d2d5a 75%, #1a1a2e 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }

        body.dark-mode .time-display,
        body.dark-mode .section {
            background: rgba(40, 40, 60, 0.75);
            color: #f5f5f7;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.35), 0 2px 8px rgba(0, 0, 0, 0.25), inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .time-item {
            background: rgba(60, 60, 80, 0.5);
            border-color: rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .time-item:hover {
            background: rgba(70, 70, 90, 0.6);
        }

        body.dark-mode .time-label {
            color: #a78bfa;
        }

        body.dark-mode .section-title {
            color: #f5f5f7;
        }

        body.dark-mode .form-group label {
            color: rgba(245, 245, 247, 0.8);
        }

        body.dark-mode .form-group input,
        body.dark-mode .form-group select {
            background: rgba(60, 60, 80, 0.6);
            border-color: rgba(255, 255, 255, 0.15);
            color: #f5f5f7;
        }

        body.dark-mode .exam-item,
        body.dark-mode .reminder-item {
            background: rgba(60, 60, 80, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 16px;
            color: #f5f5f7;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        body.dark-mode .exam-item:hover,
        body.dark-mode .reminder-item:hover {
            border-color: rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            transform: translateY(-3px);
        }

        body.dark-mode .item-title {
            color: #f5f5f7;
        }

        body.dark-mode .item-details {
            color: rgba(245, 245, 247, 0.7);
        }

        body.dark-mode .control-buttons {
            background: rgba(40, 40, 60, 0.85);
            border-color: rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        body.dark-mode .control-btn {
            background: rgba(60, 60, 80, 0.9);
            color: #f5f5f7;
            border-color: rgba(255, 255, 255, 0.15);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .control-btn:hover {
            background: rgba(80, 80, 100, 0.95);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3), 0 4px 12px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }

        body.dark-mode .control-btn.active {
            background: rgba(100, 100, 120, 0.98);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25), 0 3px 8px rgba(0, 0, 0, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        /* ÂÖ®Â±èÊ®°ÂºèÊ†∑Âºè */
        body.fullscreen-mode .header {
            position: fixed;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1003;
            margin-bottom: 0px;
            width: 100%;
            max-width: 1100px;
            text-align: center;
        }

        body.fullscreen-mode .title {
            font-size: 2.5em;
            font-weight: 700;
            color: white;
            text-shadow: 0 2px 20px rgba(0,0,0,0.25);
            margin-bottom: 10px;
            letter-spacing: -0.5px;
        }

        body.fullscreen-mode .main-content {
            display: none;
        }

        body.fullscreen-mode .seating-content {
            display: none;
        }

        body.fullscreen-mode .seating-content.active {
            display: block;
            position: fixed;
            top: 150px;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 1100px;
            z-index: 1001;
            padding: 25px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        body.fullscreen-mode .time-display {
            position: fixed;
            top: 150px;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 1100px;
            z-index: 1000;
            padding: 25px;
            box-sizing: border-box;
        }

        /* ÂÖ®Â±èÊ®°Âºè‰∏ãÈöêËóèÊó∂Èó¥ÊòæÁ§∫ÁöÑÁ±ª */
        body.fullscreen-mode .time-display.hidden {
            display: none;
        }

        body.fullscreen-mode .time-grid {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        body.fullscreen-mode .time-item {
            min-height: 120px;
            padding: 15px;
            overflow: hidden;
        }

        body.fullscreen-mode .time-label {
            font-size: 1.8em;
        }

        body.fullscreen-mode .time-value {
            font-size: 2.5em;
            line-height: 1.2;
        }

        body.fullscreen-mode .control-buttons {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) scale(1);
            transform-origin: bottom center;
            z-index: 1002;
            width: auto;
            max-width: 90%;
        }

        .fullscreen-exam-list {
            margin-top: 15px;
            padding: 20px;
            background: rgba(255,255,255,0.72);
            border-radius: 22px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.12), 0 2px 8px rgba(0,0,0,0.08), inset 0 1px 0 rgba(255,255,255,0.5);
            backdrop-filter: blur(24px) saturate(1.8);
            -webkit-backdrop-filter: blur(24px) saturate(1.8);
            border: 1px solid rgba(255,255,255,0.4);
            overflow-y: visible;
        }

        .exam-list-title {
            font-size: 1.4em;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .exam-list-title::before {
            content: "üìÖ";
            font-size: 1.2em;
        }

        .exam-list-content {
            overflow-y: visible;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 15px;
        }

        body.fullscreen-mode .fullscreen-exam-list {
            display: block !important;
        }

        body.dark-mode .exam-list-title {
            color: #f5f5f7;
        }

        body.dark-mode .fullscreen-exam-list {
            background: rgba(40, 40, 60, 0.75);
            color: #f5f5f7;
        }

        body.dark-mode .time-label {
            color: #a78bfa;
        }

        body.dark-mode .time-value {
            background: linear-gradient(135deg, #a78bfa 0%, #c084fc 50%, #e879f9 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        body.dark-mode .title {
            background: linear-gradient(135deg, #a78bfa 0%, #c084fc 50%, #e879f9 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: none;
        }

        /* Áº©ÊîæÊ†∑Âºè */
        .zoom-75 {
            transform: scale(0.75);
            transform-origin: top center;
        }

        .zoom-90 {
            transform: scale(0.9);
            transform-origin: top center;
        }

        .zoom-110 {
            transform: scale(1.1);
            transform-origin: top center;
        }

        .zoom-125 {
            transform: scale(1.25);
            transform-origin: top center;
        }

        .zoom-150 {
            transform: scale(1.5);
            transform-origin: top center;
        }

        /* ÂìçÂ∫îÂºèË∞ÉÊï¥ */
        @media (max-width: 768px) {
            .control-buttons {
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                flex-wrap: wrap;
                gap: 8px;
                padding: 10px 15px;
                max-width: 90%;
                justify-content: center;
            }

            .control-btn {
                padding: 10px 14px;
                font-size: 1em;
                min-width: 40px;
            }

            /* ÊôÆÈÄöÊ®°Âºè‰∏ãÁöÑÊâãÊú∫ÈÄÇÈÖç */
            .time-display {
                padding: 15px;
            }

            .time-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .time-item {
                min-height: 100px;
                padding: 12px;
            }

            .time-label {
                font-size: 1.3em;
            }

            .time-value {
                font-size: 1.8em;
                line-height: 1.1;
                word-break: break-all;
            }

            /* ÂÖ®Â±èÊ®°Âºè‰∏ãÁöÑÊâãÊú∫ÈÄÇÈÖç */
            body.fullscreen-mode .time-display {
                width: 95vw;
                padding: 20px;
            }

            body.fullscreen-mode .time-label {
                font-size: 1.2em;
            }

            body.fullscreen-mode .time-value {
                font-size: 1.8em;
                line-height: 1.1;
            }

            body.fullscreen-mode .time-item {
                min-height: 120px;
                padding: 15px;
            }

            body.fullscreen-mode .exam-list-content {
                grid-template-columns: 1fr;
                gap: 10px;
            }
        }

        /* È¢ùÂ§ñÂ∞èÂ±èÂπïÈÄÇÈÖç (Â∞è‰∫é480px) */
        @media (max-width: 480px) {
            .time-display {
                padding: 10px;
            }

            .time-item {
                min-height: 80px;
                padding: 8px;
            }

            .time-label {
                font-size: 1.1em;
            }

            .time-value {
                font-size: 1.5em;
                line-height: 1.0;
            }

            body.fullscreen-mode .time-value {
                font-size: 1.5em;
            }

            body.fullscreen-mode .time-label {
                font-size: 1.0em;
            }
        }

        /* ËÄÉÂú∫ÂÆâÊéíÈ°µÈù¢Ê†∑Âºè */
        .seating-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0px;
            display: none;
        }

        .seating-content.active {
            display: block;
        }

        .main-content.hidden {
            display: none;
        }

        .time-display.hidden {
            display: none;
        }

        .import-btn {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
            font-weight: bold;
            transition: all 0.3s ease;
            border: none;
            box-shadow: 0 2px 6px rgba(0,0,0,0.12);
            white-space: nowrap;
        }

        .import-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .clear-data-btn {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
            font-weight: bold;
            transition: all 0.3s ease;
            border: none;
            box-shadow: 0 2px 6px rgba(0,0,0,0.12);
            margin-left: 10px;
            white-space: nowrap;
        }

        .clear-data-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .seating-arrangement {
            background: rgba(255,255,255,0.72);
            border-radius: 22px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.12), 0 2px 8px rgba(0,0,0,0.08), inset 0 1px 0 rgba(255,255,255,0.5);
            backdrop-filter: blur(24px) saturate(1.8);
            -webkit-backdrop-filter: blur(24px) saturate(1.8);
            border: 1px solid rgba(255,255,255,0.4);
            min-height: 400px;
        }

        .no-data {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 300px;
            color: #999;
            font-size: 1.1em;
        }

        .no-data i {
            font-size: 3em;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .seating-stats {
            margin-left: auto;
            display: flex;
            gap: 15px;
            font-size: 0.9em;
            color: #666;
        }

        .stat-item {
            background: rgba(103, 126, 234, 0.1);
            padding: 5px 12px;
            border-radius: 15px;
            font-weight: 500;
        }

        .seating-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
            align-items: end;
        }

        .seating-group {
            background: rgba(255, 255, 255, 0.55);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 12px;
            padding: 8px;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            transition: all 0.3s ease;
        }

        .seating-group:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
        }

        .group-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 14px;
            border-radius: 8px;
            font-weight: 600;
            text-align: center;
            order: 2;
            margin-top: 8px;
            margin-bottom: 0;
        }

        .seats-container {
            display: flex;
            flex-direction: column-reverse;
            gap: 6px;
            min-height: 200px;
            align-items: center;
            justify-content: flex-end;
            order: 1;
        }

        .seat {
            background: rgba(255, 255, 255, 0.85);
            border: 1px solid rgba(0, 0, 0, 0.06);
            border-radius: 10px;
            padding: 8px 14px;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            width: 150px;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }

        .seat:hover {
            border-color: rgba(102, 126, 234, 0.3);
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.15);
            transform: translateY(-2px);
        }

        .seat-number {
            font-size: 1.1em;
            color: #667eea;
            font-weight: bold;
            margin-right: 8px;
        }

        .student-name {
            font-weight: bold;
            color: #333;
            font-size: 1.3em;
        }

        /* Â∫ß‰ΩçÊéßÂà∂Âå∫ÂüüÊ†∑Âºè */
        .seating-controls {
            display: flex;
            gap: 8px;
            margin: 15px 0;
            flex-wrap: nowrap;
            align-items: center;
            justify-content: flex-start;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 5px;
            flex-shrink: 0;
        }

        .control-group label {
            font-weight: 500;
            font-size: 0.8em;
            white-space: nowrap;
            min-width: fit-content;
        }

        .control-group input {
            padding: 4px 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.8em;
        }

        .control-group input[type="text"] {
            width: 90px;
        }

        .control-group input[type="number"] {
            width: 50px;
        }

        .control-group input#groupSizes {
            width: 85px;
            font-size: 18px;
        }

        /* ÁâπÂÆöËæìÂÖ•Ê°ÜÁöÑÂÆΩÂ∫¶Ë∞ÉÊï¥ */
        #queryTypeSelect {
            width: 80px !important;
            margin-right: 5px;
            font-size: 18px;
        }

        #queryInput {
            width: 80px !important;
        }

        #groupSizes {
            width: 160px !important;        
            font-size: 14px;
        }

        /* Áè≠Á∫ßÂ≠¶ÁîüÁΩëÊ†ºÊòæÁ§∫Ê†∑Âºè */
        .class-students-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 4px;
            padding: 10px;
        }

        .class-student-item {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 8px 10px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.08);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            min-width: 0;
        }

        .class-student-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.12);
        }

        .class-student-item .student-name {
            font-weight: bold;
            color: #2c3e50;
            flex-shrink: 0;
            font-size: 16px;
        }

        .class-student-item .class-seat-number {
            color: #3498db;
            font-weight: bold;
            font-size: 16px;
            margin-right: 4px;
        }

        .class-student-item .exam-seat {
            color: #e74c3c;
            white-space: nowrap;
            font-weight: bold;
            font-size: 16px;
        }

        /* Â§úÈó¥Ê®°Âºè‰∏ãÁöÑËÄÉÂú∫ÂÆâÊéíÊ†∑Âºè */
        body.dark-mode .seating-arrangement {
            background: rgba(40, 40, 60, 0.75);
            color: #f5f5f7;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .control-group label {
            color: #f5f5f7;
        }

        body.dark-mode .control-group input {
            background-color: rgba(60, 60, 80, 0.6);
            border-color: rgba(255, 255, 255, 0.15);
            color: #f5f5f7;
        }

        body.dark-mode select {
            background: rgba(60, 60, 80, 0.6);
            color: #f5f5f7;
            border-color: rgba(255, 255, 255, 0.15);
        }

        /* Áè≠Á∫ßÂ≠¶ÁîüÁΩëÊ†ºÁöÑdark modeÊ†∑Âºè */
        body.dark-mode .class-student-item {
            background: rgba(60, 60, 80, 0.5);
            border-color: rgba(255, 255, 255, 0.12);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        body.dark-mode .class-student-item:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        body.dark-mode .class-student-item .student-name {
            color: #f5f5f7;
        }

        body.dark-mode .class-student-item .class-seat-number {
            color: #a78bfa;
        }

        body.dark-mode .class-student-item .exam-seat {
            color: #f87171;
        } 

        body.dark-mode .seat {
            background: rgba(60, 60, 80, 0.5);
            border-color: rgba(255, 255, 255, 0.12);
            color: #f5f5f7;
        }

        body.dark-mode .seating-group {
            background: rgba(60, 60, 80, 0.3);
            border-color: rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .student-name {
            color: #f5f5f7;
        }

        body.dark-mode .seat-number {
            color: #a78bfa;
        }

        body.dark-mode .group-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        body.dark-mode .seating-stats {
            color: rgba(245, 245, 247, 0.7);
        }

        body.dark-mode .stat-item {
            background: rgba(102, 126, 234, 0.2);
        }

        body.dark-mode .no-data {
            color: rgba(245, 245, 247, 0.5);
        }

        /* ÂÖ®Â±èÊ®°Âºè‰∏ãÁöÑÂ§úÈó¥Ê®°ÂºèËÄÉÂú∫ÂÆâÊéíÊ†∑Âºè */
        body.fullscreen-mode.dark-mode .seating-arrangement {
            background: rgba(40, 40, 60, 0.75);
        }

        body.fullscreen-mode.dark-mode .seating-content.active {
            background: rgba(40, 40, 60, 0.75);
        }

        /* MacÈ£éÊ†ºÂúÜÂΩ¢Êó∂ÈíüÊ†∑Âºè */
        .analog-clock-item {
            cursor: pointer;
            min-height: 220px !important;
        }

        .analog-clock {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 50px;
        }

        .clock-face {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: linear-gradient(145deg, #ffffff, #f0f0f0);
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.15),
                0 4px 10px rgba(0, 0, 0, 0.1),
                inset 0 2px 4px rgba(255, 255, 255, 0.9),
                inset 0 -2px 4px rgba(0, 0, 0, 0.05);
            position: relative;
            border: 3px solid rgba(255, 255, 255, 0.8);
            flex-shrink: 0;
        }

        .clock-face::before {
            content: '12';
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 16px;
            font-weight: 600;
            color: #1d1d1f;
        }

        .clock-face::after {
            content: '6';
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 16px;
            font-weight: 600;
            color: #1d1d1f;
        }

        .clock-face .hour-3,
        .clock-face .hour-9 {
            position: absolute;
            font-size: 16px;
            font-weight: 600;
            color: #1d1d1f;
        }

        .clock-face .hour-3 {
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
        }

        .clock-face .hour-9 {
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
        }

        .clock-face .dot-marker {
            position: absolute;
            width: 5px;
            height: 5px;
            background: #1d1d1f;
            border-radius: 50%;
        }

        .clock-face .dot-1 { top: 18%; right: 24%; }
        .clock-face .dot-2 { top: 35%; right: 12%; }
        .clock-face .dot-4 { top: 65%; right: 12%; }
        .clock-face .dot-5 { top: 82%; right: 24%; }
        .clock-face .dot-7 { top: 82%; left: 24%; }
        .clock-face .dot-8 { top: 65%; left: 12%; }
        .clock-face .dot-10 { top: 35%; left: 12%; }
        .clock-face .dot-11 { top: 18%; left: 24%; }

        .clock-hand {
            position: absolute;
            bottom: 50%;
            left: 50%;
            transform-origin: bottom center;
            border-radius: 4px;
        }

        .hour-hand {
            width: 5px;
            height: 45px;
            background: linear-gradient(to top, #1d1d1f, #3d3d3f);
            margin-left: -2.5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .minute-hand {
            width: 4px;
            height: 60px;
            background: linear-gradient(to top, #1d1d1f, #4a4a4c);
            margin-left: -2px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
        }

        .second-hand {
            width: 2px;
            height: 70px;
            background: linear-gradient(to top, #ff3b30, #ff6b6b);
            margin-left: -1px;
            box-shadow: 0 2px 6px rgba(255, 59, 48, 0.4);
        }

        .clock-center {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 14px;
            height: 14px;
            background: linear-gradient(145deg, #ff3b30, #ff6b6b);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 2px 6px rgba(255, 59, 48, 0.5);
            z-index: 10;
        }

        .clock-date {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 6px;
        }

        .clock-date .date-day {
            font-size: 3.5em;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
        }

        .clock-date .date-weekday {
            font-size: 1.3em;
            font-weight: 500;
            color: #667eea;
        }

        .clock-date .date-month {
            font-size: 1.1em;
            font-weight: 500;
            color: #888;
        }

        /* DarkÊ®°ÂºèÊó∂ÈíüÊ†∑Âºè */
        body.dark-mode .clock-face {
            background: linear-gradient(145deg, #2d2d4a, #1a1a2e);
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.4),
                0 4px 10px rgba(0, 0, 0, 0.3),
                inset 0 2px 4px rgba(255, 255, 255, 0.1),
                inset 0 -2px 4px rgba(0, 0, 0, 0.2);
            border-color: rgba(255, 255, 255, 0.1);
        }

        body.dark-mode .clock-face::before,
        body.dark-mode .clock-face::after,
        body.dark-mode .clock-face .hour-3,
        body.dark-mode .clock-face .hour-9 {
            color: #f5f5f7;
        }

        body.dark-mode .clock-face .dot-marker {
            background: #f5f5f7;
        }

        body.dark-mode .hour-hand {
            background: linear-gradient(to top, #f5f5f7, #c0c0c2);
        }

        body.dark-mode .minute-hand {
            background: linear-gradient(to top, #f5f5f7, #d0d0d2);
        }

        body.dark-mode .clock-date .date-day {
            background: linear-gradient(135deg, #a78bfa 0%, #c084fc 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        body.dark-mode .clock-date .date-weekday {
            color: #a78bfa;
        }

        body.dark-mode .clock-date .date-month {
            color: rgba(245, 245, 247, 0.6);
        }

        #digitalTimeItem {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="control-buttons">
        <button class="control-btn" onclick="togglePage()" title="ËÄÉÂú∫ÂÆâÊéí" id="pageToggleBtn">
            <i class="fas fa-th"></i>
        </button>
        <button class="control-btn" onclick="zoomOut()" title="Áº©Â∞è">
            <i class="fas fa-search-minus"></i>
        </button>

        <button class="control-btn" onclick="zoomIn()" title="ÊîæÂ§ß">
            <i class="fas fa-search-plus"></i>
        </button>
        <button class="control-btn" onclick="showHelp()" title="Â∏ÆÂä©">
            <i class="fas fa-question-circle"></i>
        </button>
        <button class="control-btn" onclick="exportConfig()" title="ÂØºÂá∫ÈÖçÁΩÆ">
            <i class="fas fa-download"></i>
        </button>
        <label class="control-btn" title="ÂØºÂÖ•ÈÖçÁΩÆ" style="cursor: pointer; display: flex; align-items: center; justify-content: center;">
            <i class="fas fa-upload"></i>
            <input type="file" class="file-input" accept=".json" onchange="importConfig(event)" style="display: none;">
        </label>
        <button class="control-btn" onclick="clearLocalStorage()" title="Ê∏ÖÈô§ÁºìÂ≠ò">
            <i class="fas fa-trash-alt"></i>
        </button>
        <button class="control-btn" onclick="toggleDarkMode()" title="Â§úÈó¥Ê®°Âºè" id="darkModeBtn">
            <i class="fas fa-moon"></i>
        </button>
        <button class="control-btn" onclick="toggleFullscreen()" title="ÂÖ®Â±èÊ®°Âºè" id="fullscreenBtn">
            <i class="fas fa-expand"></i>
        </button>
        <button class="control-btn" onclick="toggleLock()" title="ÈîÅÂÆö/Ëß£ÈîÅ" id="lockBtn">
            <i class="fas fa-lock"></i>
        </button>
    </div>

    <div class="container">
        <div class="header">
            <h1 class="title" id="examTitle">ËÄÉËØïÁÆ°ÁêÜÁ≥ªÁªü</h1>
        </div>

        <div class="time-display">
            <div class="time-grid">
                <div class="time-item" id="digitalTimeItem" onclick="toggleClockStyle()">
                    <div class="time-label"></div>
                    <div class="time-value" id="currentTime">--:--:--</div>
                </div>
                <div class="time-item analog-clock-item" id="analogTimeItem" onclick="toggleClockStyle()" style="display: none;">
                    <div class="analog-clock" id="analogClock">
                        <div class="clock-face">
                            <span class="hour-3">3</span>
                            <span class="hour-9">9</span>
                            <span class="dot-marker dot-1"></span>
                            <span class="dot-marker dot-2"></span>
                            <span class="dot-marker dot-4"></span>
                            <span class="dot-marker dot-5"></span>
                            <span class="dot-marker dot-7"></span>
                            <span class="dot-marker dot-8"></span>
                            <span class="dot-marker dot-10"></span>
                            <span class="dot-marker dot-11"></span>
                            <div class="clock-hand hour-hand" id="hourHand"></div>
                            <div class="clock-hand minute-hand" id="minuteHand"></div>
                            <div class="clock-hand second-hand" id="secondHand"></div>
                            <div class="clock-center"></div>
                        </div>
                        <div class="clock-date" id="analogDate">
                            <div class="date-day"></div>
                            <div class="date-weekday"></div>
                            <div class="date-month"></div>
                        </div>
                    </div>
                </div>
                <div class="time-item">
                    <div class="time-label" id="countdownLabel"></div>
                    <div class="time-value" id="countdown">--</div>
                </div>
            </div>
            <div class="fullscreen-exam-list" id="fullscreenExamList" style="display: none;">
                <div class="exam-list-content" id="fullscreenExamListContent"></div>
            </div>
        </div>

        <div class="main-content" id="mainContent">
            <div class="section">
                <div class="section-title">
                    <i class="fas fa-calendar-alt"></i>
                    ËÄÉËØïÁÆ°ÁêÜ
                    <button class="btn btn-success btn-small" onclick="addExam()" style="margin-left: auto;">
                        <i class="fas fa-plus"></i> Ê∑ªÂä†ËÄÉËØï
                    </button>
                </div>

                <div id="examList"></div>
            </div>

            <div class="section">
                <div class="section-title">
                    <i class="fas fa-bell"></i>
                    ÊèêÈÜíËÆæÁΩÆ
                    <button class="btn btn-success btn-small" onclick="addReminder()" style="margin-left: auto;">
                        <i class="fas fa-plus"></i> Ê∑ªÂä†ÊèêÈÜí
                    </button>
                </div>

                <div id="reminderList"></div>
            </div>
        </div>

        <!-- ËÄÉÂú∫ÂÆâÊéíÈ°µÈù¢ -->
        <div class="seating-content" id="seatingContent" style="display: none;">
            <div class="section">
                <div class="section-title">
                    <i class="fas fa-th"></i>
                    ËÄÉÂú∫ÂÆâÊéí
                    <label class="import-btn">
                        <i class="fas fa-upload"></i>
                        ÂØºÂÖ•Êï∞ÊçÆ
                        <input type="file" id="excelFile" accept=".xlsx,.xls" onchange="handleExcelImport(event)" style="display: none;">
                    </label>
                    <button class="clear-data-btn" onclick="clearStudentsData()" title="Ê∏ÖÈô§Â∑≤ÂØºÂÖ•ÁöÑÂ≠¶ÁîüÊï∞ÊçÆ">
                        <i class="fas fa-trash"></i>
                        Ê∏ÖÈô§Êï∞ÊçÆ
                    </button>
                    <div class="seating-controls">
                        <div class="control-group">
                            <select id="queryTypeSelect" onchange="updateQueryType()">
                                <option value="examRoom">ËÄÉÂú∫</option>
                                <option value="class">Áè≠Á∫ß</option>
                            </select>
                            <input type="text" id="queryInput" placeholder="Â¶ÇÔºö101" onchange="performQuery()">
                        </div>
                        <div class="control-group">
                            <label for="groupCount">ÁªÑÊï∞Ôºö</label>
                            <input type="number" id="groupCount" value="5" min="1" max="10" onchange="updateGroupSettings()">
                        </div>
                        <div class="control-group">
                            <label for="groupSizes">ÂêÑÁªÑ‰∫∫Êï∞Ôºö</label>
                            <input type="text" id="groupSizes" placeholder="Â¶ÇÔºö6,7,7,7,7" onchange="updateSeatingConfig(); const queryType = document.getElementById('queryTypeSelect').value; if (queryType === 'examRoom') { updateSeatingArrangement(); }">
                        </div>
                    </div>
                    <div class="seating-stats" id="seatingStats"></div>
                </div>
                <div class="seating-arrangement" id="seatingArrangement">
                    <div class="no-data">
                        <i class="fas fa-users"></i>
                        <p>ËØ∑ÁÇπÂáª"ÂØºÂÖ•Êï∞ÊçÆ"ÊåâÈíÆÈÄâÊã©ExcelÊñá‰ª∂</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ËÄÉËØïÁºñËæëÊ®°ÊÄÅÊ°Ü -->
    <div id="examModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeExamModal()">&times;</span>
            <h2 id="examModalTitle">Ê∑ªÂä†ËÄÉËØï</h2>
            <form id="examForm">
                <div class="form-group">
                    <label for="examSubject">ÁßëÁõÆ:</label>
                    <input type="text" id="examSubject" required>
                </div>
                <div class="form-group">
                    <label for="examDate">Êó•Êúü:</label>
                    <input type="date" id="examDate" required>
                </div>
                <div class="form-group">
                    <label for="examStartTime">ÂºÄÂßãÊó∂Èó¥:</label>
                    <input type="time" id="examStartTime" required>
                </div>
                <div class="form-group">
                    <label for="examDuration">Êó∂Èïø(ÂàÜÈíü):</label>
                    <input type="number" id="examDuration" min="1" required>
                </div>
                <div class="form-group">
                    <label for="examRecurrence">Âæ™ÁéØËÆæÁΩÆ:</label>
                    <select id="examRecurrence" onchange="updateRecurrenceSettings()" required>
                        <option value="once">‰∏ÄÊ¨°</option>
                        <option value="daily">ÊØèÂ§©</option>
                        <option value="weekly">ÊØèÂë®</option>
                        <option value="monthly">ÊØèÊúà</option>
                    </select>
                </div>
                <div class="form-group" id="recurrenceEndGroup" style="display: none;">
                    <label for="recurrenceEndDate">Âæ™ÁéØÁªìÊùüÊó•Êúü:</label>
                    <input type="date" id="recurrenceEndDate">
                    <small style="color: #666; font-size: 0.8em; margin-top: 5px; display: block;">ÁïôÁ©∫Ë°®Á§∫Êó†ÈôêÂæ™ÁéØ</small>
                </div>
                <div class="form-group">
                    <label>ÁªìÊùüÊó∂Èó¥:</label>
                    <div id="examEndTime">--:--</div>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> ‰øùÂ≠ò
                    </button>
                    <button type="button" class="btn" onclick="closeExamModal()">
                        <i class="fas fa-times"></i> ÂèñÊ∂à
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ÊèêÈÜíÁºñËæëÊ®°ÊÄÅÊ°Ü -->
    <div id="reminderModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeReminderModal()">&times;</span>
            <h2 id="reminderModalTitle">Ê∑ªÂä†ÊèêÈÜí</h2>
            <form id="reminderForm">
                <div class="form-group">
                    <label for="reminderType">ÊèêÈÜíÁ±ªÂûã:</label>
                    <select id="reminderType" onchange="updateReminderForm()" required>
                        <option value="ÂºÄËÄÉÂâç">ÂºÄËÄÉÂâç</option>
                        <option value="ÁªìÊùüÂâç">ÁªìÊùüÂâç</option>
                        <option value="ÂºÄÂßãËÄÉËØï">ÂºÄÂßãËÄÉËØï</option>
                        <option value="ËÄÉËØïÁªìÊùü">ËÄÉËØïÁªìÊùü</option>
                    </select>
                </div>
                <div class="form-group" id="minutesGroup">
                    <label for="reminderMinutes">ÊèêÂâçÊó∂Èó¥(ÂàÜÈíü):</label>
                    <input type="number" id="reminderMinutes" min="1" value="15">
                </div>
                <div class="form-group">
                    <label for="reminderSound">ÈìÉÂ£∞:</label>
                    <select id="reminderSound" required>
                        <option value="">ÈÄâÊã©ÈìÉÂ£∞</option>
                    </select>
                    <div class="audio-controls">
                        <button type="button" class="btn btn-small" onclick="playSound()">
                            <i class="fas fa-play"></i> ËØïÂê¨
                        </button>
                        <label class="btn btn-small" style="color: white;">
                            <i class="fas fa-upload"></i> ÂØºÂÖ•
                            <input type="file" class="file-input" accept="audio/*" onchange="importAudio(event)">
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> ‰øùÂ≠ò
                    </button>
                    <button type="button" class="btn" onclick="closeReminderModal()">
                        <i class="fas fa-times"></i> ÂèñÊ∂à
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Â∏ÆÂä©Ê®°ÊÄÅÊ°Ü -->
    <div id="helpModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <span class="close" onclick="closeHelpModal()">&times;</span>
            <h2>üìö ËÄÉËØïÁÆ°ÁêÜÁ≥ªÁªü‰ΩøÁî®Â∏ÆÂä©</h2>
            
            <div style="max-height: 500px; overflow-y: auto; padding-right: 10px;">
                <h3>üìÖ ËÄÉËØïÁÆ°ÁêÜ</h3>
                <ul>
                    <li><strong>Ê∑ªÂä†ËÄÉËØï</strong>ÔºöÁÇπÂáª‚ÄúÊ∑ªÂä†ËÄÉËØï‚ÄùÊåâÈíÆÔºåÂ°´ÂÜôÁßëÁõÆ„ÄÅÊó•Êúü„ÄÅÊó∂Èó¥„ÄÅÊó∂ÈïøÂíåÂæ™ÁéØËÆæÁΩÆ</li>
                    <li><strong>Âæ™ÁéØËÄÉËØï</strong>ÔºöÊîØÊåÅ‰∏ÄÊ¨°„ÄÅÊØèÂ§©„ÄÅÊØèÂë®„ÄÅÊØèÊúàÂæ™ÁéØÔºåÂèØËÆæÁΩÆÁªìÊùüÊó•Êúü</li>
                    <li><strong>ÁºñËæëËÄÉËØï</strong>ÔºöÁÇπÂáªÁºñËæëÊåâÈíÆ‰øÆÊîπËÄÉËØï‰ø°ÊÅØÔºå‰øÆÊîπÂêéÊâÄÊúâÂæ™ÁéØÂÆû‰æãÈÉΩ‰ºöÊõ¥Êñ∞</li>
                    <li><strong>Âà†Èô§ËÄÉËØï</strong>ÔºöÁÇπÂáªÂà†Èô§ÊåâÈíÆÂà†Èô§ËÄÉËØïÔºåÂæ™ÁéØËÄÉËØï‰ºöÂà†Èô§Êï¥‰∏™Á≥ªÂàó</li>
                </ul>

                <h3>üîî ÊèêÈÜíËÆæÁΩÆ</h3>
                <ul>
                    <li><strong>ÂºÄËÄÉÂâç</strong>ÔºöÂú®ËÄÉËØïÂºÄÂßãÂâçÊåáÂÆöÊó∂Èó¥ÊèêÈÜí</li>
                    <li><strong>ÁªìÊùüÂâç</strong>ÔºöÂú®ËÄÉËØïÁªìÊùüÂâçÊåáÂÆöÊó∂Èó¥ÊèêÈÜí</li>
                    <li><strong>ÂºÄÂßãËÄÉËØï</strong>ÔºöËÄÉËØïÂºÄÂßãÊó∂Á´ãÂç≥ÊèêÈÜí</li>
                    <li><strong>ËÄÉËØïÁªìÊùü</strong>ÔºöËÄÉËØïÁªìÊùüÊó∂Á´ãÂç≥ÊèêÈÜí</li>
                    <li><strong>Ëá™ÂÆö‰πâÈìÉÂ£∞</strong>ÔºöÂèØÂØºÂÖ•Èü≥È¢ëÊñá‰ª∂‰Ωú‰∏∫ÊèêÈÜíÈìÉÂ£∞</li>
                </ul>

                <h3>üîÑ Âæ™ÁéØÁ±ªÂûãËØ¥Êòé</h3>
                <ul>
                    <li><strong>‰∏ÄÊ¨°</strong>Ôºö‰º†ÁªüÁöÑ‰∏ÄÊ¨°ÊÄßËÄÉËØï</li>
                    <li><strong>ÊØèÂ§©</strong>ÔºöÊØèÂ§©Âêå‰∏ÄÊó∂Èó¥ÈáçÂ§çËÄÉËØï</li>
                    <li><strong>ÊØèÂë®</strong>ÔºöÊØèÂë®Âêå‰∏ÄÊòüÊúüÂá†ÈáçÂ§çËÄÉËØï</li>
                    <li><strong>ÊØèÊúà</strong>ÔºöÊØèÊúàÂêå‰∏ÄÊó•ÊúüÈáçÂ§çËÄÉËØï</li>
                    <li><strong>ÁªìÊùüÊó•Êúü</strong>ÔºöÂèØÈÄâËÆæÁΩÆÔºåÁïôÁ©∫Ë°®Á§∫Êó†ÈôêÂæ™ÁéØ</li>
                </ul>

                <h3>‚è±Ô∏è Êó∂Èó¥ÊòæÁ§∫</h3>
                <ul>
                    <li><strong>ÂΩìÂâçÊó∂Èó¥</strong>ÔºöÂÆûÊó∂ÊòæÁ§∫Á≥ªÁªüÊó∂Èó¥ÂíåÊó•Êúü</li>
                    <li><strong>ËÄÉËØïÂÄíËÆ°Êó∂</strong>ÔºöÊòæÁ§∫Ë∑ùÁ¶ª‰∏ã‰∏ÄÂú∫ËÄÉËØïÁöÑÂâ©‰ΩôÊó∂Èó¥</li>
                    <li><strong>ËÄÉËØïËøõÂ∫¶</strong>ÔºöËÄÉËØïËøõË°å‰∏≠ÊòæÁ§∫Â∑≤ËøõË°åÂíåÂâ©‰ΩôÊó∂Èó¥</li>
                </ul>

                <h3>üéÆ ÂäüËÉΩÊåâÈíÆ</h3>
                <ul>
                    <li><strong>Áº©Êîæ</strong>ÔºöÁÇπÂáªÊîæÂ§ßÈïú„ÄÅÁº©Â∞èÈïúË∞ÉÊï¥È°µÈù¢Â§ßÂ∞è</li>
                    <li><strong>ÂØºÂá∫/ÂØºÂÖ•</strong>Ôºö‰øùÂ≠òÂíåËΩΩÂÖ•ËÄÉËØïÈÖçÁΩÆÊñá‰ª∂</li>
                    <li><strong>Ê∏ÖÈô§ÁºìÂ≠ò</strong>Ôºö‰∏ÄÈîÆÊ∏ÖÈô§ÊâÄÊúâÊú¨Âú∞Â≠òÂÇ®ÁöÑÊï∞ÊçÆÔºåÈáçÁΩÆÁ≥ªÁªüÁä∂ÊÄÅ</li>
                    <li><strong>ÈîÅÂÆö/Ëß£ÈîÅ</strong>ÔºöÈò≤Ê≠¢ËØØÊìç‰ΩúÔºåÈîÅÂÆöÁä∂ÊÄÅ‰∏ãÊó†Ê≥ï‰øÆÊîπÊï∞ÊçÆ</li>
                    <li><strong>Â§úÈó¥Ê®°Âºè</strong>ÔºöÂàáÊç¢Ê∑±Ëâ≤‰∏ªÈ¢òÔºå‰øùÊä§ÁúºÁùõ</li>
                    <li><strong>ÂÖ®Â±èÊ®°Âºè</strong>ÔºöÈöêËóèÁÆ°ÁêÜÁïåÈù¢Ôºå‰∏ìÊ≥®ÊòæÁ§∫Êó∂Èó¥ÂíåËÄÉËØï‰ø°ÊÅØ</li>
                </ul>

                <h3>‚å®Ô∏è Âø´Êç∑ÈîÆ</h3>
                <ul>
                    <li><strong>Ctrl + Âä†Âè∑</strong>ÔºöÊîæÂ§ßÈ°µÈù¢</li>
                    <li><strong>Ctrl + ÂáèÂè∑</strong>ÔºöÁº©Â∞èÈ°µÈù¢</li>
                    <li><strong>Ctrl + 0</strong>ÔºöÈáçÁΩÆÁº©Êîæ</li>
                    <li><strong>F11</strong>ÔºöÂàáÊç¢ÂÖ®Â±èÊ®°Âºè</li>
                    <li><strong>Ctrl + D</strong>ÔºöÂàáÊç¢Â§úÈó¥Ê®°Âºè</li>
                </ul>

                <h3>ü™ë ËÄÉÂú∫ÂÆâÊéí</h3>
                <ul>
                    <li><strong>ÂØºÂÖ•Êï∞ÊçÆ</strong>ÔºöÊîØÊåÅÂØºÂÖ•ExcelÊñá‰ª∂ÔºåÂåÖÂê´Â≠¶ÁîüÂßìÂêç„ÄÅËÄÉÂú∫„ÄÅÂ∫ßÂè∑„ÄÅÁè≠Á∫ßÂ∫ßÂè∑Á≠â‰ø°ÊÅØ</li>
                    <li><strong>Êï∞ÊçÆÊ†ºÂºè</strong>ÔºöExcelÊñá‰ª∂ÈúÄÂåÖÂê´"ÂßìÂêç"„ÄÅ"ËÄÉÂú∫"„ÄÅ"Â∫ßÂè∑"Á≠âÂøÖË¶ÅÂ≠óÊÆµ</li>
                    <li><strong>ËÄÉÂú∫Êü•ËØ¢</strong>ÔºöËæìÂÖ•ËÄÉÂú∫Âè∑Êü•ÁúãËØ•ËÄÉÂú∫ÁöÑÂ≠¶ÁîüÂ∫ß‰ΩçÂÆâÊéíÔºåÊåâÂ∫ßÂè∑ÂçáÂ∫èÊòæÁ§∫</li>
                    <li><strong>Áè≠Á∫ßÊü•ËØ¢</strong>ÔºöÂàáÊç¢Âà∞Áè≠Á∫ßÊ®°ÂºèÔºåËæìÂÖ•Áè≠Á∫ßÂè∑Êü•ÁúãÁè≠Á∫ßÂ≠¶Áîü‰ø°ÊÅØ</li>
                    <li><strong>Áè≠Á∫ßÊéíÂ∫è</strong>ÔºöÁè≠Á∫ßÂ≠¶ÁîüÊåâ"Áè≠Á∫ßÂ∫ßÂè∑"Â≠óÊÆµÂçáÂ∫èÊéíÂàóÔºåËã•Êó†Ê≠§Â≠óÊÆµÂàôÊåâ"Â∫ßÂè∑"ÊéíÂ∫è</li>
                    <li><strong>ÊàêÂäüÊèêÁ§∫</strong>ÔºöÂØºÂÖ•ÊàêÂäüÂêé‰ºöÊòæÁ§∫ÂØºÂÖ•ÁöÑÂ≠¶ÁîüÊï∞ÈáèÂíåËÄÉÂú∫Êï∞Èáè</li>
                    <li><strong>Ê∏ÖÈô§Êï∞ÊçÆ</strong>ÔºöÂèØ‰∏ÄÈîÆÊ∏ÖÈô§ÊâÄÊúâÂ∑≤ÂØºÂÖ•ÁöÑËÄÉÂú∫ÂÆâÊéíÊï∞ÊçÆ</li>
                    <li><strong>ÈîÅÂÆö‰øùÊä§</strong>ÔºöÂêØÁî®ÈîÅÂÆöÂêéÔºåËÄÉÂú∫ÂÆâÊéíÁöÑÂØºÂÖ•ÂíåÊ∏ÖÈô§ÂäüËÉΩÂ∞ÜË¢´Á¶ÅÁî®</li>
                </ul>

                <h3>üíæ Êï∞ÊçÆ‰øùÂ≠ò</h3>
                <ul>
                    <li>ÊâÄÊúâËÄÉËØïÂíåÊèêÈÜíËÆæÁΩÆËá™Âä®‰øùÂ≠òÂú®Êú¨Âú∞ÊµèËßàÂô®‰∏≠</li>
                    <li>ÂèØÈÄöËøáÂØºÂá∫ÂäüËÉΩÂ§á‰ªΩÈÖçÁΩÆÊñá‰ª∂</li>
                    <li>ÊîØÊåÅÂú®‰∏çÂêåËÆæÂ§áÈó¥ÂØºÂÖ•ÂØºÂá∫ÈÖçÁΩÆ</li>
                </ul>
            </div>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <script>
        // ÂÖ®Â±ÄÂèòÈáè
        let config = {
            title: 'ËÄÉËØïÁÆ°ÁêÜÁ≥ªÁªü',
            exams: [],
            reminders: []
        };
        let currentEditingExam = null;
        let currentEditingReminder = null;
        let availableSounds = [];
        let customSounds = {};
        let currentAudio = null;
        let reminderCheckInterval = null;
        let playedReminders = new Set();
        let audioQueue = [];
        let isPlayingAudio = false;
        let pendingDelayedReminders = [];

        // ËÄÉÂú∫ÂÆâÊéíÁõ∏ÂÖ≥ÂèòÈáè
        let studentsData = [];
        let currentExamRoom = '';
        let seatingConfig = {
            examRoom: '',
            groupCount: 5,
            groupSizes: '6,6,6,6,6',
            seatingResult: null
        };
        let currentPage = 'main'; // 'main' Êàñ 'seating'

        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            loadConfig();
            loadSounds();
            updateDisplay();
            startTimeUpdate();
            startReminderCheck();
            loadSettings();
            loadStudentsFromFile(); // Ëá™Âä®Âä†ËΩΩÊúÄÊñ∞ÁöÑÂ≠¶ÁîüÊï∞ÊçÆÊñá‰ª∂
            loadClassStudentsFromStorage(); // ÊÅ¢Â§çÁè≠Á∫ßÂ≠¶Áîü‰ø°ÊÅØ
            loadExamRoomFromStorage(); // ÊÅ¢Â§çËÄÉÂú∫‰ø°ÊÅØ
        });

        // Âä†ËΩΩÈÖçÁΩÆ
        async function loadConfig() {
            try {
                const response = await fetch('./exam_config.json');
                if (response.ok) {
                    const data = await response.json();
                    config = { ...config, ...data };
                    
                    // ‰ªélocalStorageÂä†ËΩΩ‰øùÂ≠òÁöÑÊï∞ÊçÆ
                    const savedConfig = localStorage.getItem('examConfig');
                    if (savedConfig) {
                        const parsed = JSON.parse(savedConfig);
                        config = { ...config, ...parsed };
                    }
                }
            } catch (error) {
                console.log('Âä†ËΩΩÈÖçÁΩÆÊñá‰ª∂Â§±Ë¥•Ôºå‰ΩøÁî®ÈªòËÆ§ÈÖçÁΩÆ');
                loadFromLocalStorage();
            }
            
            updateDisplay();
        }

        // ‰ªélocalStorageÂä†ËΩΩ
        function loadFromLocalStorage() {
            const savedConfig = localStorage.getItem('examConfig');
            if (savedConfig) {
                config = { ...config, ...JSON.parse(savedConfig) };
            }
        }

        // ‰øùÂ≠òÂà∞localStorage
        function saveToLocalStorage() {
            localStorage.setItem('examConfig', JSON.stringify(config));
        }

        // Âä†ËΩΩÈü≥È¢ëÊñá‰ª∂
        async function loadSounds() {
            const defaultSounds = [
                'before15.mp3', 'before20.mp3', 'before5.mp3',
                'end.mp3', 'end15.mp3', 'start.mp3'
            ];
            
            availableSounds = [];
            
            for (const sound of defaultSounds) {
                try {
                    const response = await fetch(`./sounds/${sound}`);
                    if (response.ok) {
                        availableSounds.push(sound);
                    }
                } catch (error) {
                    console.log(`Èü≥È¢ëÊñá‰ª∂ ${sound} ‰∏çÂ≠òÂú®`);
                }
            }
            
            // Âä†ËΩΩËá™ÂÆö‰πâÈü≥È¢ë
            const savedSounds = localStorage.getItem('customSounds');
            if (savedSounds) {
                customSounds = JSON.parse(savedSounds);
                availableSounds.push(...Object.keys(customSounds));
            }
            
            updateSoundOptions();
        }

        // Êõ¥Êñ∞Èü≥È¢ëÈÄâÈ°π
        function updateSoundOptions() {
            const select = document.getElementById('reminderSound');
            select.innerHTML = '<option value="">ÈÄâÊã©ÈìÉÂ£∞</option>';
            
            availableSounds.forEach(sound => {
                const option = document.createElement('option');
                option.value = sound;
                option.textContent = sound;
                select.appendChild(option);
            });
        }

        // Êõ¥Êñ∞ÊòæÁ§∫
        function updateDisplay() {
            document.getElementById('examTitle').textContent = config.title;
            updateExamList();
            updateReminderList();
        }

        // Êõ¥Êñ∞ËÄÉËØïÂàóË°®
        function updateExamList() {
            const examList = document.getElementById('examList');
            examList.innerHTML = '';
            
            // Ëé∑ÂèñÊâÄÊúâËÄÉËØïÂÆû‰æãÔºàÂåÖÂê´Âæ™ÁéØÁîüÊàêÁöÑÔºâ
            const allInstances = getAllExamInstances();
            
            allInstances.forEach((exam, displayIndex) => {
                const examItem = document.createElement('div');
                examItem.className = 'exam-item';
                examItem.draggable = true;
                examItem.dataset.index = exam.originalIndex; // ‰ΩøÁî®ÂéüÂßãÁ¥¢ÂºïÁî®‰∫éÁºñËæëÂíåÂà†Èô§
                
                const status = getExamStatus(exam);
                const endTime = calculateEndTime(exam.startTime, exam.duration);
                
                examItem.innerHTML = `
                    <div class="item-header">
                        <div class="item-title">${exam.subject}</div>
                        <div class="controls">
                            <span class="status-badge status-${status.class}">${status.text}</span>
                            <button class="btn btn-small exam-edit-btn" onclick="editExam(${exam.originalIndex})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-small btn-danger exam-delete-btn" onclick="deleteExam(${exam.originalIndex})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="item-details">
                        Êó•Êúü: ${exam.date} | Êó∂Èó¥: ${exam.startTime} - ${endTime} | Êó∂Èïø: ${exam.duration}ÂàÜÈíü | Âæ™ÁéØ: ${getRecurrenceText(exam.recurrence, exam.recurrenceEndDate)}
                    </div>
                `;
                
                // ÊãñÊãΩ‰∫ã‰ª∂ÔºàÂè™ÂÖÅËÆ∏ÊãñÊãΩÂéüÂßãËÄÉËØïÔºå‰∏çÂÖÅËÆ∏ÊãñÊãΩÁîüÊàêÁöÑÂÆû‰æãÔºâ
                if (exam.instanceIndex === undefined || exam.instanceIndex === 0) {
                    examItem.addEventListener('dragstart', handleDragStart);
                    examItem.addEventListener('dragover', handleDragOver);
                    examItem.addEventListener('drop', handleDrop);
                    examItem.addEventListener('dragend', handleDragEnd);
                } else {
                    examItem.draggable = false;
                    examItem.style.opacity = '0.8';
                }
                
                examList.appendChild(examItem);
            });
            
            // Êõ¥Êñ∞ÈîÅÂÆöÁä∂ÊÄÅÔºàÁ°Æ‰øùÊñ∞ÁîüÊàêÁöÑÊåâÈíÆ‰πüÂèóÈîÅÂÆöÊéßÂà∂Ôºâ
            updateLockState();
        }

        // Êõ¥Êñ∞ÊèêÈÜíÂàóË°®
        function updateReminderList() {
            const reminderList = document.getElementById('reminderList');
            reminderList.innerHTML = '';
            
            config.reminders.forEach((reminder, index) => {
                const reminderItem = document.createElement('div');
                reminderItem.className = 'reminder-item';
                reminderItem.draggable = true;
                reminderItem.dataset.index = index;
                
                const minutesText = reminder.minutes ? `${reminder.minutes}ÂàÜÈíü` : '';
                const statusText = reminder.enabled ? 'ÂêØÁî®' : 'ÊöÇÂÅú';
                const statusClass = reminder.enabled ? 'status-ongoing' : 'status-finished';
                
                reminderItem.innerHTML = `
                    <div class="item-header">
                        <div class="item-title">${reminder.type} ${minutesText}</div>
                        <div class="controls">
                            <span class="status-badge ${statusClass}">${statusText}</span>
                            <button class="btn btn-small reminder-toggle-btn" onclick="toggleReminder(${index})">
                                <i class="fas fa-${reminder.enabled ? 'pause' : 'play'}"></i>
                            </button>
                            <button class="btn btn-small reminder-edit-btn" onclick="editReminder(${index})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-small btn-danger reminder-delete-btn" onclick="deleteReminder(${index})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="item-details">
                        ÈìÉÂ£∞: ${reminder.sound}
                    </div>
                `;
                
                // ÊãñÊãΩ‰∫ã‰ª∂
                reminderItem.addEventListener('dragstart', handleReminderDragStart);
                reminderItem.addEventListener('dragover', handleDragOver);
                reminderItem.addEventListener('drop', handleReminderDrop);
                reminderItem.addEventListener('dragend', handleDragEnd);
                
                reminderList.appendChild(reminderItem);
            });
            
            // Êõ¥Êñ∞ÈîÅÂÆöÁä∂ÊÄÅÔºàÁ°Æ‰øùÊñ∞ÁîüÊàêÁöÑÊåâÈíÆ‰πüÂèóÈîÅÂÆöÊéßÂà∂Ôºâ
            updateLockState();
        }

        // Êõ¥Êñ∞Âæ™ÁéØËÆæÁΩÆ
        function updateRecurrenceSettings() {
            const recurrenceType = document.getElementById('examRecurrence').value;
            const endGroup = document.getElementById('recurrenceEndGroup');
            
            if (recurrenceType === 'once') {
                endGroup.style.display = 'none';
            } else {
                endGroup.style.display = 'block';
            }
        }

        // Ëé∑ÂèñÂæ™ÁéØÊñáÊú¨ÊèèËø∞
        function getRecurrenceText(recurrence, endDate) {
            switch (recurrence) {
                case 'once':
                    return '‰∏ÄÊ¨°';
                case 'daily':
                    if (endDate) {
                        return `ÊØèÂ§©(Ëá≥${endDate})`;
                    } else {
                        return 'ÊØèÂ§©';
                    }
                case 'weekly':
                    if (endDate) {
                        return `ÊØèÂë®(Ëá≥${endDate})`;
                    } else {
                        return 'ÊØèÂë®';
                    }
                case 'monthly':
                    if (endDate) {
                        return `ÊØèÊúà(Ëá≥${endDate})`;
                    } else {
                        return 'ÊØèÊúà';
                    }
                default:
                    return '‰∏ÄÊ¨°';
            }
        }

        // Ê†πÊçÆÂæ™ÁéØËÆæÁΩÆÁîüÊàêËÄÉËØïÂÆû‰æã
        function generateExamInstances(exam) {
            const instances = [];
            const startDate = new Date(exam.date);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            if (exam.recurrence === 'once') {
                instances.push({
                    ...exam,
                    originalIndex: exam.originalIndex || 0
                });
            } else {
                const endDate = exam.recurrenceEndDate ? new Date(exam.recurrenceEndDate) : null;
                let currentDate = new Date(startDate);
                let instanceIndex = 0;
                
                // ÊâæÂà∞Á¨¨‰∏Ä‰∏™Â§ß‰∫éÁ≠â‰∫é‰ªäÂ§©ÁöÑÊó•Êúü
                while (currentDate < today && (!endDate || currentDate <= endDate)) {
                    if (exam.recurrence === 'daily') {
                        currentDate.setDate(currentDate.getDate() + 1);
                    } else if (exam.recurrence === 'weekly') {
                        currentDate.setDate(currentDate.getDate() + 7);
                    } else if (exam.recurrence === 'monthly') {
                        currentDate.setMonth(currentDate.getMonth() + 1);
                    }
                    instanceIndex++;
                    
                    // Èò≤Ê≠¢Êó†ÈôêÂæ™ÁéØ
                    if (instanceIndex > 1000) break;
                }
                
                // Âè™Ê∑ªÂä†ÊâæÂà∞ÁöÑÊúÄËøë‰∏ÄÊ¨°ËÄÉËØï
                if (currentDate >= today && (!endDate || currentDate <= endDate)) {
                    instances.push({
                        ...exam,
                        date: currentDate.toISOString().split('T')[0],
                        originalIndex: exam.originalIndex || 0,
                        instanceIndex: instanceIndex
                    });
                }
            }
            
            return instances;
        }

        // Ëé∑ÂèñÊâÄÊúâËÄÉËØïÂÆû‰æãÔºàÂåÖÂê´Âæ™ÁéØÁîüÊàêÁöÑÔºâ
        function getAllExamInstances() {
            let allInstances = [];
            
            config.exams.forEach((exam, index) => {
                const examWithIndex = { ...exam, originalIndex: index };
                const instances = generateExamInstances(examWithIndex);
                allInstances = allInstances.concat(instances);
            });
            
            // ÊåâÊó•ÊúüÂíåÊó∂Èó¥ÊéíÂ∫è
            allInstances.sort((a, b) => {
                const dateTimeA = new Date(`${a.date} ${a.startTime}`);
                const dateTimeB = new Date(`${b.date} ${b.startTime}`);
                return dateTimeA - dateTimeB;
            });
            
            return allInstances;
        }
        function getExamStatus(exam) {
            const now = new Date();
            const examStart = new Date(`${exam.date} ${exam.startTime}`);
            const examEnd = new Date(examStart.getTime() + exam.duration * 60000);
            
            if (now < examStart) {
                return { text: 'Êú™ÂºÄÂßã', class: 'upcoming' };
            } else if (now >= examStart && now <= examEnd) {
                return { text: 'ËøõË°å‰∏≠', class: 'ongoing' };
            } else {
                return { text: 'Â∑≤ÁªìÊùü', class: 'finished' };
            }
        }

        // ËÆ°ÁÆóÁªìÊùüÊó∂Èó¥
        function calculateEndTime(startTime, duration) {
            const [hours, minutes] = startTime.split(':').map(Number);
            const startMinutes = hours * 60 + minutes;
            const endMinutes = startMinutes + duration;
            const endHours = Math.floor(endMinutes / 60) % 24;
            const endMins = endMinutes % 60;
            return `${endHours.toString().padStart(2, '0')}:${endMins.toString().padStart(2, '0')}`;
        }

        // Êõ¥Êñ∞Êó∂Èó¥ÊòæÁ§∫
        let isAnalogClock = false;

        // ÂºÄÂßãÊó∂Èó¥Êõ¥Êñ∞
        function startTimeUpdate() {
            // ÊÅ¢Â§çÊó∂ÈíüÊ†∑Âºè
            const savedClockStyle = localStorage.getItem('clockStyle');
            if (savedClockStyle === 'analog') {
                isAnalogClock = true;
                const digitalItem = document.getElementById('digitalTimeItem');
                const analogItem = document.getElementById('analogTimeItem');
                if (digitalItem) digitalItem.style.display = 'none';
                if (analogItem) analogItem.style.display = 'flex';
            }
            
            updateTime();
            setInterval(updateTime, 1000);
        }

        function toggleClockStyle() {
            isAnalogClock = !isAnalogClock;
            const digitalItem = document.getElementById('digitalTimeItem');
            const analogItem = document.getElementById('analogTimeItem');
            
            if (isAnalogClock) {
                digitalItem.style.display = 'none';
                analogItem.style.display = 'flex';
                updateAnalogClock();
            } else {
                digitalItem.style.display = 'flex';
                analogItem.style.display = 'none';
            }
            
            localStorage.setItem('clockStyle', isAnalogClock ? 'analog' : 'digital');
        }

        function updateAnalogClock() {
            if (!isAnalogClock) return;
            
            const now = new Date();
            const hours = now.getHours() % 12;
            const minutes = now.getMinutes();
            const seconds = now.getSeconds();
            
            const hourDeg = (hours * 30) + (minutes * 0.5);
            const minuteDeg = (minutes * 6) + (seconds * 0.1);
            const secondDeg = seconds * 6;
            
            const hourHand = document.getElementById('hourHand');
            const minuteHand = document.getElementById('minuteHand');
            const secondHand = document.getElementById('secondHand');
            
            if (hourHand) hourHand.style.transform = `rotate(${hourDeg}deg)`;
            if (minuteHand) minuteHand.style.transform = `rotate(${minuteDeg}deg)`;
            if (secondHand) secondHand.style.transform = `rotate(${secondDeg}deg)`;
            
            const analogDate = document.getElementById('analogDate');
            if (analogDate) {
                const dayEl = analogDate.querySelector('.date-day');
                const weekdayEl = analogDate.querySelector('.date-weekday');
                const monthEl = analogDate.querySelector('.date-month');
                
                if (dayEl) dayEl.textContent = now.getDate();
                if (weekdayEl) weekdayEl.textContent = now.toLocaleDateString('zh-CN', { weekday: 'long' });
                if (monthEl) monthEl.textContent = now.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long' });
            }
        }

        function updateTime() {
            const now = new Date();
            
            // ÂΩìÂâçÊó∂Èó¥ - ÂàÜÁ¶ªÊó∂Èó¥ÂíåÊó•Êúü
            const timeOnly = now.toLocaleTimeString('zh-CN', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            });
            const dateOnly = now.toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                weekday: 'long'
            });
            document.getElementById('currentTime').innerHTML = `<div style="font-size: 2.2em; font-weight: bold; background: linear-gradient(45deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 5px;">${timeOnly}</div><div style="font-size: 0.8em; color: #666;">${dateOnly}</div>`;
            
            // Êõ¥Êñ∞ÂúÜÂΩ¢Êó∂Èíü
            updateAnalogClock();
            
            // ËÄÉËØïÂÄíËÆ°Êó∂ÊàñËøõÂ∫¶
            updateCountdown(now);
            
            // ÊØèÂàÜÈíüÊõ¥Êñ∞‰∏ÄÊ¨°ËÄÉËØïÂàóË°®Áä∂ÊÄÅÔºàÂú®ÁßíÊï∞‰∏∫0Êó∂Ôºâ
            if (now.getSeconds() === 0) {
                updateExamList();
            }
            
            // Â¶ÇÊûúÂú®ÂÖ®Â±èÊ®°Âºè‰∏ãÔºåÊõ¥Êñ∞ËÄÉËØï‰ø°ÊÅØ
            if (document.body.classList.contains('fullscreen-mode')) {
                updateFullscreenExamInfo();
            }
        }

        // Êõ¥Êñ∞ÂÄíËÆ°Êó∂
        function updateCountdown(now) {
            const nextExam = getNextExam(now);
            const currentExam = getCurrentExam(now);
            
            if (currentExam) {
                // ÊòæÁ§∫ËÄÉËØïËøõÂ∫¶
                document.getElementById('countdownLabel').textContent = '';
                const examStart = new Date(`${currentExam.date} ${currentExam.startTime}`);
                const examEnd = new Date(examStart.getTime() + currentExam.duration * 60000);
                
                const elapsedSeconds = Math.floor((now - examStart) / 1000);
                const remainingSeconds = Math.floor((examEnd - now) / 1000);
                
                // Ê†ºÂºèÂåñÊó∂Èó¥ÊòæÁ§∫Ôºà--ÂàÜ--ÁßíÔºâ
                const formatTime = (totalSeconds) => {
                    const hours = Math.floor(totalSeconds / 3600);
                    const minutes = Math.floor((totalSeconds % 3600) / 60);
                    const seconds = totalSeconds % 60;
                    
                    if (hours > 0) {
                        const totalMinutes = hours * 60 + minutes;
                        return `${totalMinutes}ÂàÜ${seconds.toString().padStart(2, '0')}Áßí`;
                    } else {
                        return `${minutes}ÂàÜ${seconds.toString().padStart(2, '0')}Áßí`;
                    }
                };
                
                // ËÆ°ÁÆóËøõÂ∫¶ÁôæÂàÜÊØî
                const totalSeconds = currentExam.duration * 60;
                const progressPercent = Math.min((elapsedSeconds / totalSeconds) * 100, 100);
                
                // Ê†πÊçÆËøõÂ∫¶ÁôæÂàÜÊØîËÆ°ÁÆóÈ¢úËâ≤ÔºàËøîÂõûÁ∫ØËâ≤Áî®‰∫élinear-gradientÔºâ
                const getProgressColor = (percent) => {
                    if (percent <= 30) {
                        // 0-30%: ÁªøËâ≤
                        return '#37b24d';
                    } else if (percent <= 60) {
                        // 30-60%: ËìùËâ≤
                        return '#339af0';
                    } else if (percent <= 80) {
                        // 60-80%: Ê©ôËâ≤
                        return '#f76707';
                    } else {
                        // 80-100%: Á∫¢Ëâ≤
                        return '#e03131';
                    }
                };
                
                // Ê†πÊçÆËøõÂ∫¶ÁôæÂàÜÊØîËÆ°ÁÆóÊ∏êÂèòËÉåÊôØ
                const getProgressGradient = (percent) => {
                    if (percent <= 30) {
                        return `linear-gradient(45deg, #2d8f47, #37b24d)`;
                    } else if (percent <= 60) {
                        return `linear-gradient(45deg, #1971c2, #339af0)`;
                    } else if (percent <= 80) {
                        return `linear-gradient(45deg, #d9480f, #f76707)`;
                    } else {
                        return `linear-gradient(45deg, #c92a2a, #e03131)`;
                    }
                };
                
                // Ê†πÊçÆËøõÂ∫¶ÁôæÂàÜÊØîËÆ°ÁÆóÊñáÂ≠óÈ¢úËâ≤ÔºàÁ∫ØËâ≤Ôºâ
                const getTextColor = (percent) => {
                    if (percent <= 30) {
                        return '#2d8f47'; // Ê∑±ÁªøËâ≤
                    } else if (percent <= 60) {
                        return '#1971c2'; // Ê∑±ËìùËâ≤
                    } else if (percent <= 80) {
                        return '#d9480f'; // Ê∑±Ê©ôËâ≤
                    } else {
                        return '#c92a2a'; // Ê∑±Á∫¢Ëâ≤
                    }
                };
                
                // Ë∞ÉËØï‰ø°ÊÅØ
                console.log('Progress:', progressPercent, 'Color:', getProgressColor(progressPercent));
                
                document.getElementById('countdown').innerHTML = 
                    `${currentExam.subject}<br>
                    <div style="display: flex; justify-content: center; gap: 20px; margin-top: 5px; font-size: 0.6em;">
                        <span style="color: ${getTextColor(progressPercent)}; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); font-weight: bold;">Â∑≤ËøõË°å: ${formatTime(elapsedSeconds)}</span>
                        <span style="color: ${getTextColor(progressPercent)}; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); font-weight: bold;">Ââ©‰Ωô: ${formatTime(remainingSeconds)}</span>
                    </div>
                    <div class="progress-single" style="height: 20px; width: 100%; background: ${getProgressGradient(progressPercent)}; background-size: ${progressPercent}% 100%; background-repeat: no-repeat; background-color: rgba(255,255,255,0.2); border-radius: 10px; border: 1px solid rgba(255,255,255,0.3);"></div>`;
            } else if (nextExam) {
                // ÊòæÁ§∫ÂÄíËÆ°Êó∂
                document.getElementById('countdownLabel').textContent = '';
                const examStart = new Date(`${nextExam.date} ${nextExam.startTime}`);
                const timeDiff = examStart - now;
                
                const days = Math.floor(timeDiff / (24 * 60 * 60 * 1000));
                const hours = Math.floor((timeDiff % (24 * 60 * 60 * 1000)) / (60 * 60 * 1000));
                const minutes = Math.floor((timeDiff % (60 * 60 * 1000)) / (60 * 1000));
                const seconds = Math.floor((timeDiff % (60 * 1000)) / 1000);
                
                let timeDisplay;
                if (days > 0) {
                    timeDisplay = `${days}Â§©${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                } else {
                    timeDisplay = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
                
                document.getElementById('countdown').innerHTML = 
                    `Ë∑ùÁ¶ª${nextExam.subject}ÁßëÂºÄÂßãËÄÉËØïËøòÊúâ<br>${timeDisplay}`;
            } else {
                document.getElementById('countdownLabel').textContent = '';
                document.getElementById('countdown').textContent = 'ÊöÇÊó†ËÄÉËØïÂÆâÊéí';
            }
        }

        // Ëé∑Âèñ‰∏ã‰∏ÄÂú∫ËÄÉËØï
        function getNextExam(now) {
            const allInstances = getAllExamInstances();
            return allInstances
                .filter(exam => new Date(`${exam.date} ${exam.startTime}`) > now)[0]; // Â∑≤ÊåâÊó•ÊúüÊéíÂ∫è
        }

        // Ëé∑ÂèñÂΩìÂâçËÄÉËØï
        function getCurrentExam(now) {
            const allInstances = getAllExamInstances();
            return allInstances.find(exam => {
                const examStart = new Date(`${exam.date} ${exam.startTime}`);
                const examEnd = new Date(examStart.getTime() + exam.duration * 60000);
                return now >= examStart && now <= examEnd;
            });
        }

        // ÂºÄÂßãÊèêÈÜíÊ£ÄÊü•
        function startReminderCheck() {
            reminderCheckInterval = setInterval(checkReminders, 1000);
        }

        // ‰∏∫Âæ™ÁéØËÄÉËØïÁîüÊàêÊú™Êù•ÁöÑÊèêÈÜíÂÆû‰æã
        function generateUpcomingReminders(exam) {
            if (exam.recurrence === 'once') {
                return [exam];
            }
            
            const reminders = [];
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // ‰ªéÂΩìÂâçÊòæÁ§∫ÁöÑËÄÉËØïÂÆû‰æãÂºÄÂßãÔºåÁîüÊàêÊú™Êù•3Ê¨°ËÄÉËØïÁöÑÊèêÈÜí
            let currentDate = new Date(exam.date);
            let instanceIndex = exam.instanceIndex || 0;
            const endDate = exam.recurrenceEndDate ? new Date(exam.recurrenceEndDate) : null;
            
            for (let i = 0; i < 3; i++) {
                if (endDate && currentDate > endDate) break;
                
                reminders.push({
                    ...exam,
                    date: currentDate.toISOString().split('T')[0],
                    instanceIndex: instanceIndex
                });
                
                // ËÆ°ÁÆó‰∏ã‰∏ÄÊ¨°ËÄÉËØïÊó•Êúü
                if (exam.recurrence === 'daily') {
                    currentDate.setDate(currentDate.getDate() + 1);
                } else if (exam.recurrence === 'weekly') {
                    currentDate.setDate(currentDate.getDate() + 7);
                } else if (exam.recurrence === 'monthly') {
                    currentDate.setMonth(currentDate.getMonth() + 1);
                }
                instanceIndex++;
            }
            
            return reminders;
        }
        // Ëé∑Âèñ‰∏ä‰∏ÄÁßëËÄÉËØï
        function getPreviousExam(currentExam, allExamInstances) {
            // ÊåâÊó∂Èó¥ÊéíÂ∫èÊâÄÊúâËÄÉËØïÂÆû‰æã
            const sortedExams = allExamInstances.slice().sort((a, b) => {
                const dateTimeA = new Date(`${a.date} ${a.startTime}`);
                const dateTimeB = new Date(`${b.date} ${b.startTime}`);
                return dateTimeA - dateTimeB;
            });
            
            const currentExamDateTime = new Date(`${currentExam.date} ${currentExam.startTime}`);
            
            // ÊâæÂà∞ÂΩìÂâçËÄÉËØïÁöÑ‰ΩçÁΩÆÔºåËøîÂõûÂâç‰∏Ä‰∏™ËÄÉËØï
            for (let i = 0; i < sortedExams.length; i++) {
                const examDateTime = new Date(`${sortedExams[i].date} ${sortedExams[i].startTime}`);
                if (examDateTime.getTime() === currentExamDateTime.getTime() && 
                    sortedExams[i].subject === currentExam.subject) {
                    // ÊâæÂà∞ÂΩìÂâçËÄÉËØïÔºåËøîÂõûÂâç‰∏Ä‰∏™ËÄÉËØïÔºàÂ¶ÇÊûúÂ≠òÂú®Ôºâ
                    return i > 0 ? sortedExams[i - 1] : null;
                }
            }
            
            return null;
        }

        // Ê£ÄÊü•ÊèêÈÜí
        function checkReminders() {
            const now = new Date();
            
            // Ê∏ÖÁêÜËøáÊúüÁöÑÂ∑≤Êí≠ÊîæÊèêÈÜíËÆ∞ÂΩï
            cleanupPlayedReminders(now);
            
            // Â§ÑÁêÜÂª∂ËøüÊí≠ÊîæÁöÑÊèêÈÜí
            processDelayedReminders(now);
            
            // Ëé∑ÂèñÊâÄÊúâËÄÉËØïÂÆû‰æãÔºà‰ΩÜ‰∏∫Âæ™ÁéØËÄÉËØïÁîüÊàêÊú™Êù•ÁöÑÊèêÈÜíÔºâ
            const allExamInstances = getAllExamInstances();
            
            allExamInstances.forEach(exam => {
                // ‰∏∫Âæ™ÁéØËÄÉËØïÁîüÊàêÊú™Êù•ÁöÑÊèêÈÜíÂÆû‰æã
                const reminderInstances = generateUpcomingReminders(exam);
                
                reminderInstances.forEach(reminderExam => {
                    config.reminders.forEach(reminder => {
                        if (!reminder.enabled) return;
                        
                        const examStart = new Date(`${reminderExam.date} ${reminderExam.startTime}`);
                        const examEnd = new Date(examStart.getTime() + reminderExam.duration * 60000);
                        
                        // ‰∏∫Âæ™ÁéØËÄÉËØïÂàõÂª∫ÂîØ‰∏ÄÁöÑÊèêÈÜíÈîÆÂÄº
                        let reminderKey = `${reminderExam.subject}-${reminderExam.date}-${reminder.type}-${reminder.minutes || 0}`;
                        if (reminderExam.instanceIndex !== undefined) {
                            reminderKey += `-${reminderExam.instanceIndex}`;
                        }
                        
                        if (playedReminders.has(reminderKey)) return;
                        
                        let shouldPlay = false;
                        let isEndReminder = false;
                        
                        switch (reminder.type) {
                            case 'ÂºÄËÄÉÂâç':
                                const beforeTime = new Date(examStart.getTime() - (reminder.minutes || 0) * 60000);
                                const timeDiff = now - beforeTime;
                                shouldPlay = timeDiff >= 0 && timeDiff <= 5000 && now < examStart;
                                
                                // Ê£ÄÊü•ÊòØÂê¶Â∫îËØ•Á¶ÅÊ≠¢Êí≠Êä•ÔºöÂú®‰∏ä‰∏ÄÁßëËÄÉËØïÁªìÊùüÂâçÁ¶ÅÊ≠¢Êí≠Êä•‰∏ã‰∏ÄÁßëÁöÑ‰ªª‰ΩïÂºÄËÄÉÂâçÊèêÈÜí
                                if (shouldPlay) {
                                    const previousExam = getPreviousExam(reminderExam, allExamInstances);
                                    if (previousExam) {
                                        const prevExamEnd = new Date(`${previousExam.date} ${previousExam.startTime}`);
                                        prevExamEnd.setMinutes(prevExamEnd.getMinutes() + previousExam.duration);
                                        
                                        // Â¶ÇÊûú‰∏ä‰∏ÄÁßëËÄÉËØïËøòÊú™ÁªìÊùüÔºåÂàôÁ¶ÅÊ≠¢Êí≠Êä•‰∏ã‰∏ÄÁßëÁöÑ‰ªª‰ΩïÂºÄËÄÉÂâçÊèêÈÜí
                                        if (now < prevExamEnd) {
                                            shouldPlay = false;
                                            console.log(`ÈòªÊ≠¢ÂºÄËÄÉÂâçÊèêÈÜíÔºö‰∏ä‰∏ÄÁßë${previousExam.subject}ËøòÊú™ÁªìÊùü`);
                                        }
                                    }
                                }
                                break;
                            case 'ÁªìÊùüÂâç':
                                const beforeEndTime = new Date(examEnd.getTime() - (reminder.minutes || 0) * 60000);
                                const endTimeDiff = now - beforeEndTime;
                                shouldPlay = endTimeDiff >= 0 && endTimeDiff <= 5000 && now < examEnd;
                                break;
                            case 'ÂºÄÂßãËÄÉËØï':
                                shouldPlay = now >= examStart && (now - examStart) <= 2000;
                                break;
                            case 'ËÄÉËØïÁªìÊùü':
                                shouldPlay = now >= examEnd && (now - examEnd) <= 2000;
                                isEndReminder = true;
                                break;
                        }
                        
                        if (shouldPlay) {
                            // Ê£ÄÊü•ËØ≠Èü≥ÂÜ≤Á™Å
                            const conflictingReminder = checkAudioConflict(reminder, reminderExam, now, allExamInstances);
                            
                            if (conflictingReminder) {
                                // Â§ÑÁêÜÂÜ≤Á™ÅÔºöÂ¶ÇÊûúÂΩìÂâçÊòØËÄÉËØïÁªìÊùüÊèêÈÜí‰∏éÂºÄËÄÉÂâçÊèêÈÜíÂÜ≤Á™Å
                                if (isEndReminder && conflictingReminder.type === 'ÂºÄËÄÉÂâç') {
                                    // ÂÖàÊí≠ÊîæËÄÉËØïÁªìÊùüÊèêÈÜí
                                    addToAudioQueue(reminder, reminderExam, reminderKey);
                                    
                                    // 30ÁßíÂêéÊí≠ÊîæÂºÄËÄÉÂâçÊèêÈÜí
                                    const delayedTime = new Date(now.getTime() + 30000);
                                    pendingDelayedReminders.push({
                                        reminder: conflictingReminder.reminder,
                                        exam: conflictingReminder.exam,
                                        key: conflictingReminder.key,
                                        scheduledTime: delayedTime
                                    });
                                    
                                    console.log(`ÂÜ≤Á™ÅÂ§ÑÁêÜÔºöÂÖàÊí≠Êîæ${reminder.type}Ôºå30ÁßíÂêéÊí≠Êîæ${conflictingReminder.type}`);
                                } else {
                                    // ÂÖ∂‰ªñÂÜ≤Á™ÅÊÉÖÂÜµÔºåÁõ¥Êé•Âä†ÂÖ•ÈòüÂàó
                                    addToAudioQueue(reminder, reminderExam, reminderKey);
                                }
                            } else {
                                addToAudioQueue(reminder, reminderExam, reminderKey);
                            }
                            
                            playedReminders.add(reminderKey);
                        }
                    });
                });
            });
            
            // Â§ÑÁêÜÈü≥È¢ëÈòüÂàó
            processAudioQueue();
        }

        // Ê∏ÖÁêÜËøáÊúüÁöÑÂ∑≤Êí≠ÊîæÊèêÈÜíËÆ∞ÂΩï
        function cleanupPlayedReminders(now) {
            const keysToRemove = [];
            
            playedReminders.forEach(key => {
                // Ëß£ÊûêÊèêÈÜíÈîÆÂÄºÔºöÁßëÁõÆ-Êó•Êúü-Á±ªÂûã-ÂàÜÈíüÊï∞
                const parts = key.split('-');
                if (parts.length >= 3) {
                    const examDate = parts[1];
                    const examTime = config.exams.find(exam => 
                        exam.subject === parts[0] && exam.date === examDate
                    );
                    
                    if (examTime) {
                        const examStart = new Date(`${examTime.date} ${examTime.startTime}`);
                        const examEnd = new Date(examStart.getTime() + examTime.duration * 60000);
                        
                        // Â¶ÇÊûúËÄÉËØïÂ∑≤ÁªìÊùüË∂ÖËøá1Â∞èÊó∂ÔºåÊ∏ÖÁêÜÁõ∏ÂÖ≥ÊèêÈÜíËÆ∞ÂΩï
                        if (now - examEnd > 60 * 60 * 1000) {
                            keysToRemove.push(key);
                        }
                    }
                }
            });
            
            keysToRemove.forEach(key => playedReminders.delete(key));
        }

        // Ê£ÄÊü•Èü≥È¢ëÂÜ≤Á™Å
        function checkAudioConflict(currentReminder, currentExam, now, allExamInstances) {
            const currentTime = now.getTime();
            const conflictBufferTime = 10000; // 10ÁßíÁºìÂÜ≤Êó∂Èó¥
            
            // Ê£ÄÊü•ÊòØÂê¶Ê≠£Âú®Êí≠ÊîæÈü≥È¢ë
            if (isPlayingAudio) {
                return { 
                    type: 'playing',
                    reminder: currentReminder,
                    exam: currentExam,
                    key: `${currentExam.subject}-${currentExam.date}-${currentReminder.type}-${currentReminder.minutes || 0}`
                };
            }
            
            // Ê£ÄÊü•ÂêåÊó∂Èó¥ÊÆµÂÜÖÁöÑÂÖ∂‰ªñÊèêÈÜíÔºàÁâπÂà´ÊòØËÄÉËØïÁªìÊùü‰∏éÂºÄËÄÉÂâçÊèêÈÜíÔºâ
            for (const exam of allExamInstances) {
                const reminderInstances = generateUpcomingReminders(exam);
                
                for (const reminderExam of reminderInstances) {
                    if (reminderExam.subject === currentExam.subject && 
                        reminderExam.date === currentExam.date &&
                        reminderExam.startTime === currentExam.startTime) {
                        continue; // Ë∑≥ËøáÂêå‰∏ÄËÄÉËØï
                    }
                    
                    for (const reminder of config.reminders) {
                        if (!reminder.enabled || reminder === currentReminder) continue;
                        
                        const examStart = new Date(`${reminderExam.date} ${reminderExam.startTime}`);
                        const examEnd = new Date(examStart.getTime() + reminderExam.duration * 60000);
                        
                        let reminderTime;
                        
                        switch (reminder.type) {
                            case 'ÂºÄËÄÉÂâç':
                                reminderTime = new Date(examStart.getTime() - (reminder.minutes || 0) * 60000);
                                break;
                            case 'ÁªìÊùüÂâç':
                                reminderTime = new Date(examEnd.getTime() - (reminder.minutes || 0) * 60000);
                                break;
                            case 'ÂºÄÂßãËÄÉËØï':
                                reminderTime = examStart;
                                break;
                            case 'ËÄÉËØïÁªìÊùü':
                                reminderTime = examEnd;
                                break;
                            default:
                                continue;
                        }
                        
                        // Ê£ÄÊü•Êó∂Èó¥ÊòØÂê¶Âú®ÂÜ≤Á™ÅÁºìÂÜ≤ËåÉÂõ¥ÂÜÖ
                        const timeDiff = Math.abs(currentTime - reminderTime.getTime());
                        
                        if (timeDiff <= conflictBufferTime) {
                            return {
                                type: reminder.type,
                                reminder: reminder,
                                exam: reminderExam,
                                key: `${reminderExam.subject}-${reminderExam.date}-${reminder.type}-${reminder.minutes || 0}`,
                                timeDiff: timeDiff
                            };
                        }
                    }
                }
            }
            
            return null;
        }
        
        // Ê∑ªÂä†Âà∞Èü≥È¢ëÈòüÂàó
        function addToAudioQueue(reminder, exam, key) {
            audioQueue.push({
                reminder: reminder,
                exam: exam,
                key: key,
                timestamp: Date.now()
            });
            
            console.log(`Ê∑ªÂä†Âà∞Èü≥È¢ëÈòüÂàó: ${exam.subject} - ${reminder.type}`);
        }
        
        // Â§ÑÁêÜÈü≥È¢ëÈòüÂàó
        function processAudioQueue() {
            if (isPlayingAudio || audioQueue.length === 0) {
                return;
            }
            
            const queueItem = audioQueue.shift();
            isPlayingAudio = true;
            
            console.log(`ÂºÄÂßãÊí≠Êîæ: ${queueItem.exam.subject} - ${queueItem.reminder.type}`);
            
            const audio = new Audio();
            
            if (customSounds[queueItem.reminder.sound]) {
                audio.src = customSounds[queueItem.reminder.sound];
            } else {
                audio.src = `./sounds/${queueItem.reminder.sound}`;
            }
            
            audio.onended = () => {
                isPlayingAudio = false;
                console.log(`Êí≠ÊîæÁªìÊùü: ${queueItem.exam.subject} - ${queueItem.reminder.type}`);
                
                // Â¶ÇÊûúÊòØËÄÉËØïÁªìÊùüÊèêÈÜíÔºåÊ£ÄÊü•ÊòØÂê¶Êú¨Âú∫ÂÖ®ÈÉ®ËÄÉËØïÂ∑≤ÁªìÊùü
                if (queueItem.reminder.type === 'ËÄÉËØïÁªìÊùü') {
                    checkAllExamsEndedForToday(queueItem.exam);
                }
                
                // ÁªßÁª≠Â§ÑÁêÜÈòüÂàó‰∏≠ÁöÑ‰∏ã‰∏Ä‰∏™Èü≥È¢ë
                setTimeout(() => {
                    processAudioQueue();
                }, 500); // 0.5ÁßíÈó¥Èöî
            };
            
            audio.onerror = () => {
                isPlayingAudio = false;
                console.error(`Êí≠ÊîæÂ§±Ë¥•: ${queueItem.reminder.sound}`);
                showNotification(`Êí≠ÊîæÊèêÈÜíÂ§±Ë¥•: ${queueItem.reminder.sound}`, 'error');
                
                // ÁªßÁª≠Â§ÑÁêÜÈòüÂàó‰∏≠ÁöÑ‰∏ã‰∏Ä‰∏™Èü≥È¢ë
                setTimeout(() => {
                    processAudioQueue();
                }, 500);
            };
            
            audio.play().catch(error => {
                isPlayingAudio = false;
                console.error('Êí≠ÊîæÈü≥È¢ëÂ§±Ë¥•:', error);
                showNotification(`Êí≠ÊîæÊèêÈÜíÂ§±Ë¥•: ${queueItem.reminder.sound}`, 'error');
                
                // ÁªßÁª≠Â§ÑÁêÜÈòüÂàó‰∏≠ÁöÑ‰∏ã‰∏Ä‰∏™Èü≥È¢ë
                setTimeout(() => {
                    processAudioQueue();
                }, 500);
            });
            
            const message = `${queueItem.exam.subject} - ${queueItem.reminder.type}${queueItem.reminder.minutes ? `(${queueItem.reminder.minutes}ÂàÜÈíü)` : ''}`;
            showNotification(message);
        }
        
        // Â§ÑÁêÜÂª∂ËøüÊí≠ÊîæÁöÑÊèêÈÜí
        function processDelayedReminders(now) {
            const readyReminders = [];
            const remainingReminders = [];
            
            pendingDelayedReminders.forEach(delayedItem => {
                if (now >= delayedItem.scheduledTime) {
                    // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÊí≠ÊîæËøá
                    if (!playedReminders.has(delayedItem.key)) {
                        readyReminders.push(delayedItem);
                        playedReminders.add(delayedItem.key);
                    }
                } else {
                    remainingReminders.push(delayedItem);
                }
            });
            
            // Êõ¥Êñ∞ÂæÖÂ§ÑÁêÜÂàóË°®
            pendingDelayedReminders = remainingReminders;
            
            // Â∞ÜÂáÜÂ§áÂ•ΩÁöÑÊèêÈÜíÂä†ÂÖ•Èü≥È¢ëÈòüÂàó
            readyReminders.forEach(item => {
                addToAudioQueue(item.reminder, item.exam, item.key);
                console.log(`Âª∂ËøüÊèêÈÜíÂáÜÂ§áÊí≠Êîæ: ${item.exam.subject} - ${item.reminder.type}`);
            });
        }

        // Ê∑ªÂä†ËÄÉËØï
        function addExam() {
            currentEditingExam = null;
            document.getElementById('examModalTitle').textContent = 'Ê∑ªÂä†ËÄÉËØï';
            document.getElementById('examForm').reset();
            
            // ÈáçÁΩÆÂæ™ÁéØËÆæÁΩÆ‰∏∫ÈªòËÆ§ÂÄº
            document.getElementById('examRecurrence').value = 'once';
            document.getElementById('recurrenceEndDate').value = '';
            updateRecurrenceSettings();
            
            document.getElementById('examModal').style.display = 'block';
        }

        // ÁºñËæëËÄÉËØï
        function editExam(index) {
            currentEditingExam = index;
            const exam = config.exams[index];
            document.getElementById('examModalTitle').textContent = 'ÁºñËæëËÄÉËØï';
            document.getElementById('examSubject').value = exam.subject;
            document.getElementById('examDate').value = exam.date;
            document.getElementById('examStartTime').value = exam.startTime;
            document.getElementById('examDuration').value = exam.duration;
            
            // ËÆæÁΩÆÂæ™ÁéØÈÄâÈ°π
            document.getElementById('examRecurrence').value = exam.recurrence || 'once';
            document.getElementById('recurrenceEndDate').value = exam.recurrenceEndDate || '';
            
            updateRecurrenceSettings();
            updateEndTime();
            document.getElementById('examModal').style.display = 'block';
        }

        // Âà†Èô§ËÄÉËØï
        function deleteExam(index) {
            if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ËÄÉËØïÂêóÔºü')) {
                config.exams.splice(index, 1);
                saveToLocalStorage();
                updateExamList();
                showNotification('ËÄÉËØïÂ∑≤Âà†Èô§');
            }
        }

        // ÂÖ≥Èó≠ËÄÉËØïÊ®°ÊÄÅÊ°Ü
        function closeExamModal() {
            document.getElementById('examModal').style.display = 'none';
        }

        // Êõ¥Êñ∞ÁªìÊùüÊó∂Èó¥
        function updateEndTime() {
            const startTime = document.getElementById('examStartTime').value;
            const duration = parseInt(document.getElementById('examDuration').value) || 0;
            
            if (startTime && duration) {
                const endTime = calculateEndTime(startTime, duration);
                document.getElementById('examEndTime').textContent = endTime;
            } else {
                document.getElementById('examEndTime').textContent = '--:--';
            }
        }

        // ËÄÉËØïË°®Âçï‰∫ã‰ª∂
        document.getElementById('examForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const exam = {
                subject: document.getElementById('examSubject').value,
                date: document.getElementById('examDate').value,
                startTime: document.getElementById('examStartTime').value,
                duration: parseInt(document.getElementById('examDuration').value),
                recurrence: document.getElementById('examRecurrence').value,
                recurrenceEndDate: document.getElementById('recurrenceEndDate').value || null
            };
            
            if (currentEditingExam !== null) {
                // Ê∏ÖÁêÜ‰∏éËØ•ËÄÉËØïÁõ∏ÂÖ≥ÁöÑÂ∑≤Êí≠ÊîæÊèêÈÜíËÆ∞ÂΩï
                const oldExam = config.exams[currentEditingExam];
                
                // Âà†Èô§ÊâÄÊúâ‰∏éÊóßËÄÉËØïÁõ∏ÂÖ≥ÁöÑÂ∑≤Êí≠ÊîæÊèêÈÜíËÆ∞ÂΩï
                const keysToRemove = [];
                playedReminders.forEach(key => {
                    // Ê£ÄÊü•ÈîÆÂÄºÊòØÂê¶ÂåÖÂê´ÊóßËÄÉËØïÁöÑÁßëÁõÆÂíåÊó•Êúü
                    if (key.startsWith(`${oldExam.subject}-${oldExam.date}-`)) {
                        keysToRemove.push(key);
                    }
                });
                
                // Âà†Èô§ÂåπÈÖçÁöÑÈîÆÂÄº
                keysToRemove.forEach(key => playedReminders.delete(key));
                
                config.exams[currentEditingExam] = exam;
                showNotification('ËÄÉËØïÂ∑≤Êõ¥Êñ∞');
                
                // Á´ãÂç≥Ê£ÄÊü•ÊòØÂê¶ÊúâÈúÄË¶ÅÊí≠ÊîæÁöÑÊèêÈÜí
                setTimeout(() => {
                    checkReminders();
                }, 100);
            } else {
                config.exams.push(exam);
                showNotification('ËÄÉËØïÂ∑≤Ê∑ªÂä†');
            }
            
            saveToLocalStorage();
            updateExamList();
            closeExamModal();
        });

        // ÁõëÂê¨Êó∂Èó¥ÂíåÊó∂ÈïøÂèòÂåñ
        document.getElementById('examStartTime').addEventListener('input', updateEndTime);
        document.getElementById('examDuration').addEventListener('input', updateEndTime);

        // Ê∑ªÂä†ÊèêÈÜí
        function addReminder() {
            currentEditingReminder = null;
            document.getElementById('reminderModalTitle').textContent = 'Ê∑ªÂä†ÊèêÈÜí';
            document.getElementById('reminderForm').reset();
            document.getElementById('reminderType').value = 'ÂºÄËÄÉÂâç';
            updateReminderForm();
            document.getElementById('reminderModal').style.display = 'block';
        }

        // ÁºñËæëÊèêÈÜí
        function editReminder(index) {
            currentEditingReminder = index;
            const reminder = config.reminders[index];
            document.getElementById('reminderModalTitle').textContent = 'ÁºñËæëÊèêÈÜí';
            document.getElementById('reminderType').value = reminder.type;
            document.getElementById('reminderMinutes').value = reminder.minutes || 15;
            document.getElementById('reminderSound').value = reminder.sound;
            updateReminderForm();
            document.getElementById('reminderModal').style.display = 'block';
        }

        // Âà†Èô§ÊèêÈÜí
        function deleteReminder(index) {
            if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ÊèêÈÜíÂêóÔºü')) {
                config.reminders.splice(index, 1);
                saveToLocalStorage();
                updateReminderList();
                showNotification('ÊèêÈÜíÂ∑≤Âà†Èô§');
            }
        }

        // ÂàáÊç¢ÊèêÈÜíÁä∂ÊÄÅ
        function toggleReminder(index) {
            config.reminders[index].enabled = !config.reminders[index].enabled;
            saveToLocalStorage();
            updateReminderList();
            const status = config.reminders[index].enabled ? 'ÂêØÁî®' : 'ÊöÇÂÅú';
            showNotification(`ÊèêÈÜíÂ∑≤${status}`);
        }

        // ÂÖ≥Èó≠ÊèêÈÜíÊ®°ÊÄÅÊ°Ü
        function closeReminderModal() {
            document.getElementById('reminderModal').style.display = 'none';
        }

        // ÊòæÁ§∫Â∏ÆÂä©
        function showHelp() {
            document.getElementById('helpModal').style.display = 'block';
        }
        



        // ÂÖ≥Èó≠Â∏ÆÂä©Ê®°ÊÄÅÊ°Ü
        function closeHelpModal() {
            document.getElementById('helpModal').style.display = 'none';
        }

        // Êõ¥Êñ∞ÊèêÈÜíË°®Âçï
        function updateReminderForm() {
            const type = document.getElementById('reminderType').value;
            const minutesGroup = document.getElementById('minutesGroup');
            
            if (type === 'ÂºÄËÄÉÂâç' || type === 'ÁªìÊùüÂâç') {
                minutesGroup.style.display = 'block';
            } else {
                minutesGroup.style.display = 'none';
            }
        }

        // ÊèêÈÜíË°®Âçï‰∫ã‰ª∂
        document.getElementById('reminderForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const type = document.getElementById('reminderType').value;
            const reminder = {
                type: type,
                sound: document.getElementById('reminderSound').value,
                enabled: true
            };
            
            if (type === 'ÂºÄËÄÉÂâç' || type === 'ÁªìÊùüÂâç') {
                reminder.minutes = parseInt(document.getElementById('reminderMinutes').value);
            }
            
            if (currentEditingReminder !== null) {
                config.reminders[currentEditingReminder] = reminder;
                showNotification('ÊèêÈÜíÂ∑≤Êõ¥Êñ∞');
            } else {
                config.reminders.push(reminder);
                showNotification('ÊèêÈÜíÂ∑≤Ê∑ªÂä†');
            }
            
            saveToLocalStorage();
            updateReminderList();
            closeReminderModal();
        });

        // Êí≠ÊîæÈü≥È¢ë
        function playSound() {
            const soundFile = document.getElementById('reminderSound').value;
            if (!soundFile) {
                showNotification('ËØ∑ÂÖàÈÄâÊã©ÈìÉÂ£∞', 'error');
                return;
            }
            
            // Â¶ÇÊûúÊ≠£Âú®Êí≠ÊîæÂÖ∂‰ªñÈü≥È¢ëÔºåÂÖàÂÅúÊ≠¢
            if (currentAudio) {
                currentAudio.pause();
                currentAudio = null;
            }
            
            currentAudio = new Audio();
            
            if (customSounds[soundFile]) {
                currentAudio.src = customSounds[soundFile];
            } else {
                currentAudio.src = `./sounds/${soundFile}`;
            }
            
            currentAudio.play().catch(error => {
                console.error('Êí≠ÊîæÈü≥È¢ëÂ§±Ë¥•:', error);
                showNotification('Êí≠ÊîæÈü≥È¢ëÂ§±Ë¥•', 'error');
            });
        }

        // ÂØºÂÖ•Èü≥È¢ë
        function importAudio(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('audio/')) {
                showNotification('ËØ∑ÈÄâÊã©Èü≥È¢ëÊñá‰ª∂', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const fileName = file.name;
                customSounds[fileName] = e.target.result;
                localStorage.setItem('customSounds', JSON.stringify(customSounds));
                
                if (!availableSounds.includes(fileName)) {
                    availableSounds.push(fileName);
                    updateSoundOptions();
                }
                
                document.getElementById('reminderSound').value = fileName;
                showNotification(`Èü≥È¢ë ${fileName} ÂØºÂÖ•ÊàêÂäü`);
            };
            reader.readAsDataURL(file);
        }

        // ÂØºÂá∫ÈÖçÁΩÆ
        function exportConfig() {
            const dataStr = JSON.stringify(config, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'exam_config.json';
            link.click();
            URL.revokeObjectURL(url);
            showNotification('ÈÖçÁΩÆÂ∑≤ÂØºÂá∫');
        }

        // ÂØºÂÖ•ÈÖçÁΩÆ
        function importConfig(event) {
            // Ê£ÄÊü•ÈîÅÂÆöÁä∂ÊÄÅ
            if (isLocked) {
                showNotification('ÂΩìÂâçÂ§Ñ‰∫éÈîÅÂÆöÁä∂ÊÄÅÔºåÊó†Ê≥ïÂØºÂÖ•ÈÖçÁΩÆ', 'error');
                event.target.value = ''; // Ê∏ÖÁ©∫Êñá‰ª∂ÈÄâÊã©
                return;
            }
            
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedConfig = JSON.parse(e.target.result);
                    config = { ...config, ...importedConfig };
                    saveToLocalStorage();
                    updateDisplay();
                    showNotification('ÈÖçÁΩÆÂØºÂÖ•ÊàêÂäü');
                } catch (error) {
                    showNotification('ÈÖçÁΩÆÊñá‰ª∂Ê†ºÂºèÈîôËØØ', 'error');
                }
            };
            reader.readAsText(file);
        }

        // Ê∏ÖÈô§Êú¨Âú∞Â≠òÂÇ®
        function clearLocalStorage() {
            // Ê£ÄÊü•ÈîÅÂÆöÁä∂ÊÄÅ
            if (isLocked) {
                showNotification('ÂΩìÂâçÂ§Ñ‰∫éÈîÅÂÆöÁä∂ÊÄÅÔºåÊó†Ê≥ïÊ∏ÖÈô§ÁºìÂ≠ò', 'error');
                return;
            }

            if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÈô§ÊâÄÊúâÊú¨Âú∞Êï∞ÊçÆÂêóÔºüËøôÂ∞ÜÈáçÁΩÆÊâÄÊúâËÆæÁΩÆ„ÄÅËÄÉËØïÂíåÊèêÈÜíÔºå‰∏îÊó†Ê≥ïÊÅ¢Â§ç„ÄÇ')) {
                localStorage.clear();
                showNotification('Êú¨Âú∞Êï∞ÊçÆÂ∑≤Ê∏ÖÈô§ÔºåÁ≥ªÁªüÂç≥Â∞ÜÂà∑Êñ∞');
                setTimeout(() => {
                    // Âà∑Êñ∞È°µÈù¢ÔºåÂº∫Âà∂ÈáçÊñ∞Âä†ËΩΩÊúÄÊñ∞ÁöÑstudents.jsonÊñá‰ª∂
                    location.reload(true);
                }, 1000);
            }
        }

        // ÊãñÊãΩÂäüËÉΩ - ËÄÉËØï
        let draggedExamIndex = null;
        
        function handleDragStart(e) {
            draggedExamIndex = parseInt(e.target.dataset.index);
            e.target.classList.add('dragging');
        }
        
        function handleDragOver(e) {
            e.preventDefault();
            e.target.closest('.exam-item')?.classList.add('drag-over');
        }
        
        function handleDrop(e) {
            e.preventDefault();
            const targetIndex = parseInt(e.target.closest('.exam-item').dataset.index);
            
            if (draggedExamIndex !== null && draggedExamIndex !== targetIndex) {
                const draggedExam = config.exams[draggedExamIndex];
                config.exams.splice(draggedExamIndex, 1);
                config.exams.splice(targetIndex, 0, draggedExam);
                saveToLocalStorage();
                updateExamList();
                showNotification('ËÄÉËØïÈ°∫Â∫èÂ∑≤Ë∞ÉÊï¥');
            }
            
            document.querySelectorAll('.exam-item').forEach(item => {
                item.classList.remove('drag-over');
            });
        }
        
        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            document.querySelectorAll('.exam-item, .reminder-item').forEach(item => {
                item.classList.remove('drag-over');
            });
            draggedExamIndex = null;
            draggedReminderIndex = null;
        }

        // ÊãñÊãΩÂäüËÉΩ - ÊèêÈÜí
        let draggedReminderIndex = null;
        
        function handleReminderDragStart(e) {
            draggedReminderIndex = parseInt(e.target.dataset.index);
            e.target.classList.add('dragging');
        }
        
        function handleReminderDrop(e) {
            e.preventDefault();
            const targetIndex = parseInt(e.target.closest('.reminder-item').dataset.index);
            
            if (draggedReminderIndex !== null && draggedReminderIndex !== targetIndex) {
                const draggedReminder = config.reminders[draggedReminderIndex];
                config.reminders.splice(draggedReminderIndex, 1);
                config.reminders.splice(targetIndex, 0, draggedReminder);
                saveToLocalStorage();
                updateReminderList();
                showNotification('ÊèêÈÜíÈ°∫Â∫èÂ∑≤Ë∞ÉÊï¥');
            }
            
            document.querySelectorAll('.reminder-item').forEach(item => {
                item.classList.remove('drag-over');
            });
        }

        // ÊòæÁ§∫ÈÄöÁü•
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
        window.onclick = function(event) {
            const examModal = document.getElementById('examModal');
            const reminderModal = document.getElementById('reminderModal');
            const helpModal = document.getElementById('helpModal');
            
            if (event.target === examModal) {
                closeExamModal();
            }
            if (event.target === reminderModal) {
                closeReminderModal();
            }
            if (event.target === helpModal) {
                closeHelpModal();
            }
        }

        // Áº©ÊîæÂäüËÉΩ
        let currentZoom = 100;
        const zoomLevels = [75, 90, 100, 110, 125, 150];

        function zoomIn() {
            const currentIndex = zoomLevels.indexOf(currentZoom);
            if (currentIndex < zoomLevels.length - 1) {
                currentZoom = zoomLevels[currentIndex + 1];
                applyZoom();
            }
        }

        function zoomOut() {
            const currentIndex = zoomLevels.indexOf(currentZoom);
            if (currentIndex > 0) {
                currentZoom = zoomLevels[currentIndex - 1];
                applyZoom();
            }
        }

        function resetZoom() {
            currentZoom = 100;
            applyZoom();
        }

        function applyZoom() {
            const container = document.querySelector('.container');
            container.className = container.className.replace(/zoom-\d+/g, '');
            
            if (currentZoom !== 100) {
                container.classList.add(`zoom-${currentZoom}`);
            }
            
            localStorage.setItem('zoomLevel', currentZoom);
            showNotification(`Áº©Êîæ: ${currentZoom}%`);
        }

        // Â§úÈó¥Ê®°ÂºèÂäüËÉΩ
        function toggleDarkMode() {
            const body = document.body;
            const darkModeBtn = document.getElementById('darkModeBtn');
            
            body.classList.toggle('dark-mode');
            
            if (body.classList.contains('dark-mode')) {
                darkModeBtn.innerHTML = '<i class="fas fa-sun"></i>';
                darkModeBtn.classList.add('active');
                localStorage.setItem('darkMode', 'true');
                showNotification('Â§úÈó¥Ê®°ÂºèÂ∑≤ÂºÄÂêØ');
            } else {
                darkModeBtn.innerHTML = '<i class="fas fa-moon"></i>';
                darkModeBtn.classList.remove('active');
                localStorage.setItem('darkMode', 'false');
                showNotification('Â§úÈó¥Ê®°ÂºèÂ∑≤ÂÖ≥Èó≠');
            }
        }

        // ÂÖ®Â±èÊ®°ÂºèÂäüËÉΩ
        function toggleFullscreen() {
            const body = document.body;
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            const timeDisplay = document.querySelector('.time-display');
            const mainContent = document.getElementById('mainContent');
            
            body.classList.toggle('fullscreen-mode');
            
            if (body.classList.contains('fullscreen-mode')) {
                fullscreenBtn.innerHTML = '<i class="fas fa-compress"></i>';
                fullscreenBtn.classList.add('active');
                
                // Â¶ÇÊûúÂΩìÂâçÂú®Â∫ß‰ΩçÂÆâÊéíÈ°µÈù¢ÔºåÊ∑ªÂä†activeÁ±ª‰ª•Âú®ÂÖ®Â±èÊ®°Âºè‰∏ãÊòæÁ§∫ÔºåÂπ∂ÈöêËóèÊó∂Èó¥ÊòæÁ§∫
                if (currentPage === 'seating') {
                    document.getElementById('seatingContent').classList.add('active');
                    timeDisplay.classList.add('hidden');
                } else if (currentPage === 'main') {
                    // Â¶ÇÊûúÂΩìÂâçÂú®ËÄÉËØïÊí≠Êä•È°µÈù¢ÔºåÁ°Æ‰øùmain-contentÈöêËóè
                    mainContent.style.display = 'none';
                }
                
                // Êõ¥Êñ∞ÂÖ®Â±èÊ®°Âºè‰∏ãÁöÑËÄÉËØï‰ø°ÊÅØ
                updateFullscreenExamInfo();
                
                // ËØ∑Ê±ÇÊµèËßàÂô®ÂÖ®Â±è
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen();
                } else if (document.documentElement.webkitRequestFullscreen) {
                    document.documentElement.webkitRequestFullscreen();
                } else if (document.documentElement.msRequestFullscreen) {
                    document.documentElement.msRequestFullscreen();
                }
                
                showNotification('ÂÖ®Â±èÊ®°ÂºèÂ∑≤ÂºÄÂêØ');
            } else {
                fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i>';
                fullscreenBtn.classList.remove('active');
                
                // ÈÄÄÂá∫ÂÖ®Â±èÊ®°ÂºèÊó∂ÁßªÈô§activeÁ±ªÂíåhiddenÁ±ª
                document.getElementById('seatingContent').classList.remove('active');
                timeDisplay.classList.remove('hidden');
                
                // ÈÄÄÂá∫ÂÖ®Â±èÊ®°ÂºèÊó∂ÔºåÊ†πÊçÆÂΩìÂâçÈ°µÈù¢Áä∂ÊÄÅÊÅ¢Â§çmain-contentÊòæÁ§∫
                if (currentPage === 'main') {
                    mainContent.style.removeProperty('display');
                }
                
                // ÈÄÄÂá∫ÊµèËßàÂô®ÂÖ®Â±è
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
                
                showNotification('ÂÖ®Â±èÊ®°ÂºèÂ∑≤ÂÖ≥Èó≠');
            }
        }

        // Êõ¥Êñ∞ÂÖ®Â±èÊ®°Âºè‰∏ãÁöÑËÄÉËØï‰ø°ÊÅØ
        function updateFullscreenExamInfo() {
            const examListContent = document.getElementById('fullscreenExamListContent');
            
            const allInstances = getAllExamInstances();
            
            if (allInstances.length === 0) {
                examListContent.innerHTML = '<div style="text-align: center; color: #666; padding: 20px;">ÊöÇÊó†ËÄÉËØïÂÆâÊéí</div>';
                return;
            }
            
            examListContent.innerHTML = '';
            
            // Âè™ÊòæÁ§∫Ââç10‰∏™ËÄÉËØïÂÆû‰æãÈÅøÂÖçÂÖ®Â±èÊ®°Âºè‰∏ãÂÜÖÂÆπËøáÂ§ö
            const displayInstances = allInstances.slice(0, 10);
            
            displayInstances.forEach((exam, index) => {
                const examItem = document.createElement('div');
                examItem.className = 'exam-item';
                
                const status = getExamStatus(exam);
                const endTime = calculateEndTime(exam.startTime, exam.duration);
                
                examItem.innerHTML = `
                    <div class="item-header">
                        <div class="item-title">${exam.subject}</div>
                        <div class="controls">
                            <span class="status-badge status-${status.class}">${status.text}</span>
                        </div>
                    </div>
                    <div class="item-details">
                        Êó•Êúü: ${exam.date} | Êó∂Èó¥: ${exam.startTime} - ${endTime} | Êó∂Èïø: ${exam.duration}ÂàÜÈíü | Âæ™ÁéØÔºö${getRecurrenceText(exam.recurrence, exam.recurrenceEndDate)}
                    </div>
                `;
                
                examListContent.appendChild(examItem);
            });
        }

        // ÁõëÂê¨ÊµèËßàÂô®ÂÖ®Â±èÁä∂ÊÄÅÂèòÂåñ
        document.addEventListener('fullscreenchange', handleFullscreenChange);
        document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
        document.addEventListener('msfullscreenchange', handleFullscreenChange);

        function handleFullscreenChange() {
            const isFullscreen = !!(document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement);
            const body = document.body;
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            
            if (!isFullscreen && body.classList.contains('fullscreen-mode')) {
                body.classList.remove('fullscreen-mode');
                fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i>';
                fullscreenBtn.classList.remove('active');
                
                // ‰øÆÂ§çÈÄÄÂá∫ÂÖ®Â±èÂêéÁöÑÁïåÈù¢Áä∂ÊÄÅ
                const mainContent = document.getElementById('mainContent');
                const timeDisplay = document.querySelector('.time-display');
                const seatingContent = document.getElementById('seatingContent');
                
                if (currentPage === 'main') {
                    // Â¶ÇÊûúÂΩìÂâçÊòØËÄÉËØïÁÆ°ÁêÜÈ°µÈù¢ÔºåÁ°Æ‰øùÊ≠£Á°ÆÊòæÁ§∫
                    mainContent.style.removeProperty('display');
                    timeDisplay.classList.remove('hidden');
                } else if (currentPage === 'seating') {
                    // Â¶ÇÊûúÂΩìÂâçÊòØÂ∫ß‰ΩçÂÆâÊéíÈ°µÈù¢Ôºå‰øùÊåÅÂ∫ß‰ΩçÂÆâÊéíÊòæÁ§∫
                    seatingContent.classList.remove('active');
                    timeDisplay.classList.remove('hidden');
                }
            }
        }

        // Âä†ËΩΩ‰øùÂ≠òÁöÑËÆæÁΩÆ
        function loadSettings() {
            // Âä†ËΩΩÁº©ÊîæËÆæÁΩÆ
            const savedZoom = localStorage.getItem('zoomLevel');
            if (savedZoom) {
                currentZoom = parseInt(savedZoom);
                applyZoom();
            }
            
            // Âä†ËΩΩÂ§úÈó¥Ê®°ÂºèËÆæÁΩÆ
            const savedDarkMode = localStorage.getItem('darkMode');
            if (savedDarkMode === 'true') {
                document.body.classList.add('dark-mode');
                const darkModeBtn = document.getElementById('darkModeBtn');
                darkModeBtn.innerHTML = '<i class="fas fa-sun"></i>';
                darkModeBtn.classList.add('active');
            }
        }

        // Âú®Áé∞ÊúâÁöÑDOMContentLoaded‰∫ã‰ª∂‰∏≠Ë∞ÉÁî®loadSettings
        // Ê≥®ÊÑèÔºöloadSettings()Â∫îËØ•Âú®Áé∞ÊúâÁöÑÂàùÂßãÂåñÂáΩÊï∞‰∏≠Ë∞ÉÁî®

        // ÈîÆÁõòÂø´Êç∑ÈîÆ
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + Plus: ÊîæÂ§ß
            if ((e.ctrlKey || e.metaKey) && (e.key === '+' || e.key === '=')) {
                e.preventDefault();
                zoomIn();
            }
            // Ctrl/Cmd + Minus: Áº©Â∞è
            else if ((e.ctrlKey || e.metaKey) && e.key === '-') {
                e.preventDefault();
                zoomOut();
            }
            // Ctrl/Cmd + 0: ÈáçÁΩÆÁº©Êîæ
            else if ((e.ctrlKey || e.metaKey) && e.key === '0') {
                e.preventDefault();
                resetZoom();
            }
            // F11: ÂÖ®Â±èÊ®°Âºè
            else if (e.key === 'F11') {
                e.preventDefault();
                toggleFullscreen();
            }
            // Ctrl/Cmd + D: Â§úÈó¥Ê®°Âºè
            else if ((e.ctrlKey || e.metaKey) && e.key === 'd') {
                e.preventDefault();
                toggleDarkMode();
            }
        });

        // È°µÈù¢ÂàáÊç¢ÂäüËÉΩ
        async function togglePage() {
            const btn = document.getElementById('pageToggleBtn');
            const isFullscreen = document.body.classList.contains('fullscreen-mode');
            const timeDisplay = document.querySelector('.time-display');
            const mainContent = document.getElementById('mainContent');
            
            if (currentPage === 'main') {
                // ÂàáÊç¢Âà∞Â∫ß‰ΩçÂÆâÊéíÈ°µÈù¢
                currentPage = 'seating';
                mainContent.style.display = 'none';
                document.getElementById('seatingContent').style.display = 'block';
                
                // Âú®ÂÖ®Â±èÊ®°Âºè‰∏ãÊ∑ªÂä†activeÁ±ªÂπ∂ÈöêËóèÊó∂Èó¥ÊòæÁ§∫
                if (isFullscreen) {
                    document.getElementById('seatingContent').classList.add('active');
                    timeDisplay.classList.add('hidden');
                }
                
                btn.innerHTML = '<i class="fas fa-bell"></i>';
                btn.title = 'ËÄÉËØïÊí≠Êä•';
                btn.classList.add('active');
                
                // Âä†ËΩΩÂ∫ß‰ΩçÂÆâÊéíÈÖçÁΩÆ
                await loadSeatingConfig();
                
                // ÊÅ¢Â§çÁè≠Á∫ßÂ≠¶Áîü‰ø°ÊÅØ
                loadClassStudentsFromStorage();
                
                // ÊÅ¢Â§çËÄÉÂú∫‰ø°ÊÅØ
                loadExamRoomFromStorage();
            } else {
                // ÂàáÊç¢ÂõûËÄÉËØïÊí≠Êä•È°µÈù¢
                currentPage = 'main';
                document.getElementById('seatingContent').style.display = 'none';
                
                // ÁßªÈô§activeÁ±ª
                document.getElementById('seatingContent').classList.remove('active');
                
                // Âú®ÂÖ®Â±èÊ®°Âºè‰∏ãÔºå‰∏çÊòæÁ§∫main-contentÔºåÂè™ÊòæÁ§∫Êó∂Èó¥ÊòæÁ§∫
                if (isFullscreen) {
                    mainContent.style.display = 'none';
                    timeDisplay.classList.remove('hidden');
                    // Á°Æ‰øùÊó∂Èó¥ÊòæÁ§∫Ê≠£Â∏∏Êõ¥Êñ∞
                    updateTime();
                } else {
                    // ÈùûÂÖ®Â±èÊ®°Âºè‰∏ãÊ≠£Â∏∏ÊòæÁ§∫main-contentÔºåÁßªÈô§ÂÜÖËÅîÊ†∑ÂºèËÆ©CSSÊéßÂà∂Â∏ÉÂ±Ä
                    mainContent.style.removeProperty('display');
                    // Á°Æ‰øùÊó∂Èó¥ÊòæÁ§∫Ê≠£Â∏∏Êõ¥Êñ∞
                    updateTime();
                }
                
                btn.innerHTML = '<i class="fas fa-th"></i>';
                btn.title = 'ËÄÉÂú∫ÂÆâÊéí';
                btn.classList.remove('active');
            }
        }

        async function showSeatingPage() {
            currentPage = 'seating';
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('seatingContent').style.display = 'block';
            
            // Âä†ËΩΩÂ∫ß‰ΩçÂÆâÊéíÈÖçÁΩÆ
            await loadSeatingConfig();
            
            // ÊÅ¢Â§çÁè≠Á∫ßÂ≠¶Áîü‰ø°ÊÅØ
            loadClassStudentsFromStorage();
            
            // ÊÅ¢Â§çËÄÉÂú∫‰ø°ÊÅØ
            loadExamRoomFromStorage();
        }

        function showMainPage() {
            currentPage = 'main';
            document.getElementById('mainContent').style.removeProperty('display');
            document.getElementById('seatingContent').style.display = 'none';
        }

        // ËÄÉÂú∫ÂÆâÊéíÁõ∏ÂÖ≥ÂáΩÊï∞
        async function loadSeatingConfig() {
            // È¶ñÂÖàÂ∞ùËØï‰ªéstudents.jsonËá™Âä®Âä†ËΩΩÂ≠¶ÁîüÊï∞ÊçÆ
            await loadStudentsFromFile();
            
            const saved = localStorage.getItem('seatingConfig');
            if (saved) {
                seatingConfig = { ...seatingConfig, ...JSON.parse(saved) };
                
                // ÊÅ¢Â§çÁïåÈù¢Áä∂ÊÄÅ
                if (seatingConfig.examRoom) {
                    document.getElementById('queryInput').value = seatingConfig.examRoom;
                    currentExamRoom = seatingConfig.examRoom;
                }
                
                if (seatingConfig.groupCount) {
                    document.getElementById('groupCount').value = seatingConfig.groupCount;
                }
                
                if (seatingConfig.groupSizes) {
                    document.getElementById('groupSizes').value = seatingConfig.groupSizes;
                }
            }
            
            // Â¶ÇÊûúËá™Âä®Âä†ËΩΩÂ§±Ë¥•ÔºåÂ∞ùËØï‰ªélocalStorageÂä†ËΩΩÂ≠¶ÁîüÊï∞ÊçÆ
            if (studentsData.length === 0) {
                const savedStudents = localStorage.getItem('studentsData');
                if (savedStudents) {
                    studentsData = JSON.parse(savedStudents);
                }
            }
            
            updateSeatingArrangement();
        }

        // CSVËß£ÊûêÂáΩÊï∞ - ÊîØÊåÅUTF-8ÁºñÁ†Å
        function parseCSV(csvText) {
            // ÁßªÈô§UTF-8 BOMÊ†áËÆ∞ÔºàÂ¶ÇÊûúÂ≠òÂú®Ôºâ
            if (csvText.charCodeAt(0) === 0xFEFF) {
                csvText = csvText.slice(1);
            }
            
            const lines = csvText.trim().split(/\r?\n/); // ÊîØÊåÅ‰∏çÂêåÁöÑÊç¢Ë°åÁ¨¶
            if (lines.length < 2) return []; // Ëá≥Â∞ëÈúÄË¶ÅË°®Â§¥Âíå‰∏ÄË°åÊï∞ÊçÆ
            
            // Ëß£ÊûêË°®Â§¥
            const headers = parseCSVLine(lines[0]);
            
            // È™åËØÅÂøÖË¶ÅÂ≠óÊÆµ
            const requiredFields = ['ÂßìÂêç', 'ËÄÉÂú∫', 'Â∫ßÂè∑'];
            const missingFields = requiredFields.filter(field => !headers.includes(field));
            if (missingFields.length > 0) {
                console.error(`CSVÊñá‰ª∂Áº∫Â∞ëÂøÖË¶ÅÂ≠óÊÆµ: ${missingFields.join(', ')}`);
                return [];
            }
            
            // Ëß£ÊûêÊï∞ÊçÆË°å
            const data = [];
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue; // Ë∑≥ËøáÁ©∫Ë°å
                
                const values = parseCSVLine(line);
                if (values.length !== headers.length) {
                    console.warn(`Á¨¨${i + 1}Ë°åÊï∞ÊçÆÂàóÊï∞‰∏çÂåπÈÖçÔºåË∑≥ËøáËØ•Ë°å`);
                    continue;
                }
                
                const row = {};
                headers.forEach((header, index) => {
                    row[header] = values[index];
                });
                
                data.push(row);
            }
            
            return data;
        }

        // Ëß£ÊûêCSVË°åÔºåÊ≠£Á°ÆÂ§ÑÁêÜÂºïÂè∑ÂíåÈÄóÂè∑
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    if (inQuotes && line[i + 1] === '"') {
                        // ËΩ¨‰πâÁöÑÂºïÂè∑
                        current += '"';
                        i++; // Ë∑≥Ëøá‰∏ã‰∏Ä‰∏™ÂºïÂè∑
                    } else {
                        // ÂàáÊç¢ÂºïÂè∑Áä∂ÊÄÅ
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    // Â≠óÊÆµÂàÜÈöîÁ¨¶
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            
            // Ê∑ªÂä†ÊúÄÂêé‰∏Ä‰∏™Â≠óÊÆµ
            result.push(current.trim());
            
            return result;
        }

        // Ëá™Âä®Âä†ËΩΩÂ≠¶ÁîüÊï∞ÊçÆÊñá‰ª∂
        async function loadStudentsFromFile() {
            try {
                // È¶ñÂÖàÂ∞ùËØïÂä†ËΩΩ students.jsonÔºàÊ∑ªÂä†Êó∂Èó¥Êà≥Èò≤Ê≠¢ÁºìÂ≠òÔºâ
                let response = await fetch('./students.json?_=' + new Date().getTime());
                if (response.ok) {
                    const data = await response.json();
                    if (Array.isArray(data) && data.length > 0) {
                        studentsData = data;
                        // ‰øùÂ≠òÂà∞localStorageÔºåÁ°Æ‰øù‰∏ãÊ¨°Âä†ËΩΩÊõ¥Âø´
                        localStorage.setItem('studentsData', JSON.stringify(studentsData));
                        
                        // ÈùôÈªòÂä†ËΩΩÊàêÂäü
                        return;
                    }
                }
                
                // Â¶ÇÊûú students.json ‰∏çÂ≠òÂú®Êàñ‰∏∫Á©∫ÔºåÂ∞ùËØïÂä†ËΩΩ students.csvÔºàÊ∑ªÂä†Êó∂Èó¥Êà≥Èò≤Ê≠¢ÁºìÂ≠òÔºâ
                response = await fetch('./students.csv?_=' + new Date().getTime());
                if (response.ok) {
                    const csvText = await response.text();
                    if (csvText.trim()) {
                        const data = parseCSV(csvText);
                        if (data.length > 0) {
                            studentsData = data;
                            // ‰øùÂ≠òÂà∞localStorageÔºåÁ°Æ‰øù‰∏ãÊ¨°Âä†ËΩΩÊõ¥Âø´
                            localStorage.setItem('studentsData', JSON.stringify(studentsData));
                            
                            // ÈùôÈªòÂä†ËΩΩÊàêÂäü
                            return;
                        }
                    }
                }
                
                // Â¶ÇÊûú‰∏§ÁßçÊñá‰ª∂ÈÉΩ‰∏çÂ≠òÂú®Êàñ‰∏∫Á©∫ÔºåÊèêÁ§∫Áî®Êà∑ÊâãÂä®ÂØºÂÖ•
                console.log('Êú™ÊâæÂà∞ students.json Êàñ students.csv Êñá‰ª∂ÔºåËØ∑ÊâãÂä®ÂØºÂÖ•ExcelÊñá‰ª∂');
                
            } catch (error) {
                console.log('Ëá™Âä®Âä†ËΩΩÂ≠¶ÁîüÊï∞ÊçÆÂ§±Ë¥•ÔºåËØ∑ÊâãÂä®ÂØºÂÖ•ExcelÊñá‰ª∂:', error.message);
            }
        }

        function saveSeatingConfig() {
            localStorage.setItem('seatingConfig', JSON.stringify(seatingConfig));
        }

        function updateSeatingConfig() {
            seatingConfig.examRoom = currentExamRoom;
            seatingConfig.groupCount = parseInt(document.getElementById('groupCount').value) || 5;
            seatingConfig.groupSizes = document.getElementById('groupSizes').value || '6,6,6,6,6';
            saveSeatingConfig();
        }

        function saveSeatingResult(seatingGroups) {
            seatingConfig.seatingResult = seatingGroups;
            saveSeatingConfig();
        }

        function updateGroupSettings() {
            updateSeatingConfig();
            // Ê£ÄÊü•ÂΩìÂâçÊü•ËØ¢Á±ªÂûãÔºåÂè™ÊúâÂú®ËÄÉÂú∫Êü•ËØ¢Êó∂ÊâçÊõ¥Êñ∞Â∫ß‰ΩçÂÆâÊéí
            const queryType = document.getElementById('queryTypeSelect').value;
            if (queryType === 'examRoom') {
                updateSeatingArrangement();
            }
        }

        function handleExcelImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    if (jsonData.length === 0) {
                        showSeatingNotification('ExcelÊñá‰ª∂‰∏∫Á©∫ÊàñÊ†ºÂºè‰∏çÊ≠£Á°Æ', 'error');
                        return;
                    }
                    
                    // È™åËØÅÂøÖË¶ÅÂ≠óÊÆµ
                    const requiredFields = ['ÂßìÂêç', 'ËÄÉÂú∫', 'Â∫ßÂè∑'];
                    const firstRow = jsonData[0];
                    const missingFields = requiredFields.filter(field => !(field in firstRow));
                    
                    if (missingFields.length > 0) {
                        showSeatingNotification(`ExcelÊñá‰ª∂Áº∫Â∞ëÂøÖË¶ÅÂ≠óÊÆµ: ${missingFields.join(', ')}`, 'error');
                        return;
                    }
                    
                    // ‰øùÂ≠òÊï∞ÊçÆÂà∞ÂÜÖÂ≠òÔºå‰ΩÜ‰∏çËá™Âä®‰øùÂ≠òÂà∞localStorage
                    studentsData = jsonData;
                    // ÊâãÂä®ÂØºÂÖ•Êó∂‰ªçÁÑ∂‰øùÂ≠òÂà∞localStorageÔºå‰ΩÜ‰ºöÂú®ËÄÉËØïÁªìÊùüÂêéÊ∏ÖÈô§
                    localStorage.setItem('studentsData', JSON.stringify(studentsData));
                    localStorage.setItem('studentsDataImportTime', new Date().toISOString());
                    
                    // Ëé∑ÂèñÊâÄÊúâËÄÉÂú∫
                    const examRooms = [...new Set(studentsData.map(s => s['ËÄÉÂú∫']).filter(Boolean))];
                    
                    showSeatingNotification(`ÊàêÂäüÂØºÂÖ• ${studentsData.length} Êù°Â≠¶ÁîüÊï∞ÊçÆÔºåÂåÖÂê´ ${examRooms.length} ‰∏™ËÄÉÂú∫`);
                    
                    // Â¶ÇÊûúÂè™Êúâ‰∏Ä‰∏™ËÄÉÂú∫ÔºåËá™Âä®Â°´ÂÖ•
                    if (examRooms.length === 1) {
                        document.getElementById('queryInput').value = examRooms[0];
                        currentExamRoom = examRooms[0];
                        updateSeatingArrangement();
                    }
                    
                } catch (error) {
                    console.error('ExcelËß£ÊûêÈîôËØØ:', error);
                    showSeatingNotification('ExcelÊñá‰ª∂Ëß£ÊûêÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•Êñá‰ª∂Ê†ºÂºè', 'error');
                }
            };
            
            reader.readAsArrayBuffer(file);
            event.target.value = '';
        }

        function clearStudentsData() {
            if (confirm(`Á°ÆÂÆöË¶ÅÊ∏ÖÈô§Â∑≤ÂØºÂÖ•ÁöÑ ${studentsData.length} Êù°Â≠¶ÁîüÊï∞ÊçÆÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ`)) {
                studentsData = [];
                localStorage.removeItem('studentsData');
                
                document.getElementById('queryInput').value = '';
                currentExamRoom = '';
                
                seatingConfig.seatingResult = null;
                seatingConfig.examRoom = '';
                saveSeatingConfig();
                
                updateSeatingArrangement();
                showSeatingNotification('Â≠¶ÁîüÊï∞ÊçÆÂ∑≤Ê∏ÖÈô§');
            }
        }

        function filterStudents() {
            const queryType = document.getElementById('queryTypeSelect').value;
            const queryValue = document.getElementById('queryInput').value.trim();
            
            if (queryType === 'examRoom') {
                currentExamRoom = queryValue;
                updateSeatingConfig();
                updateSeatingArrangement();
            } else if (queryType === 'class') {
                queryClassStudents(queryValue);
            }
        }

        function performQuery() {
            filterStudents();
        }

        function updateQueryType() {
            const queryType = document.getElementById('queryTypeSelect').value;
            const queryInput = document.getElementById('queryInput');
            
            if (queryType === 'examRoom') {
                queryInput.placeholder = 'Â¶ÇÔºö101';
                // ÂàáÊç¢Âà∞ËÄÉÂú∫Êü•ËØ¢Êó∂ÔºåÂ∞ùËØïÊÅ¢Â§çËÄÉÂú∫‰ø°ÊÅØ
                const saved = localStorage.getItem('currentExamRoomInfo');
                if (saved) {
                    try {
                        const examRoomInfo = JSON.parse(saved);
                        queryInput.value = examRoomInfo.examRoom;
                        currentExamRoom = examRoomInfo.examRoom;
                        // ÊÅ¢Â§çËÄÉÂú∫‰ø°ÊÅØÂπ∂Êõ¥Êñ∞ÊòæÁ§∫
                        updateSeatingArrangement();
                        return;
                    } catch (error) {
                        console.error('ÊÅ¢Â§çËÄÉÂú∫‰ø°ÊÅØÂ§±Ë¥•:', error);
                    }
                }
                // Â¶ÇÊûúÊ≤°Êúâ‰øùÂ≠òÁöÑËÄÉÂú∫‰ø°ÊÅØÔºåÂàôÊ∏ÖÁ©∫
                queryInput.value = '';
                currentExamRoom = '';
                updateSeatingArrangement();
            } else if (queryType === 'class') {
                queryInput.placeholder = 'Â¶ÇÔºö1';
                // ÂàáÊç¢Âà∞Áè≠Á∫ßÊü•ËØ¢Êó∂ÔºåÂ∞ùËØïÊÅ¢Â§çÁè≠Á∫ß‰ø°ÊÅØ
                const saved = localStorage.getItem('currentClassStudents');
                if (saved) {
                    try {
                        const classInfo = JSON.parse(saved);
                        queryInput.value = classInfo.classNumber;
                        // ÊÅ¢Â§çÁè≠Á∫ß‰ø°ÊÅØÂπ∂Êõ¥Êñ∞ÊòæÁ§∫
                        loadClassStudentsFromStorage();
                        return;
                    } catch (error) {
                        console.error('ÊÅ¢Â§çÁè≠Á∫ß‰ø°ÊÅØÂ§±Ë¥•:', error);
                    }
                }
                // Â¶ÇÊûúÊ≤°Êúâ‰øùÂ≠òÁöÑÁè≠Á∫ß‰ø°ÊÅØÔºåÂàôÊ∏ÖÁ©∫
                queryInput.value = '';
                const seatingArrangement = document.getElementById('seatingArrangement');
                seatingArrangement.innerHTML = `
                    <div class="no-data">
                        <i class="fas fa-users"></i>
                        <p>ËØ∑ËæìÂÖ•Áè≠Á∫ßÂè∑</p>
                    </div>
                `;
            }
        }

        function queryClassStudents(classNumber) {
            if (!studentsData.length) {
                showSeatingNotification('ËØ∑ÂÖàÂØºÂÖ•Â≠¶ÁîüÊï∞ÊçÆ', 'error');
                return;
            }
            
            if (!classNumber) {
                // Ê∏ÖÁ©∫Â∫ß‰ΩçÂÆâÊéíÊòæÁ§∫
                const seatingArrangement = document.getElementById('seatingArrangement');
                seatingArrangement.innerHTML = `
                    <div class="no-data">
                        <i class="fas fa-users"></i>
                        <p>ËØ∑ËæìÂÖ•Áè≠Á∫ßÂè∑</p>
                    </div>
                `;
                document.getElementById('seatingStats').innerHTML = '';
                // Ê∏ÖÁ©∫Êú¨Âú∞Â≠òÂÇ®ÁöÑÁè≠Á∫ß‰ø°ÊÅØ
                localStorage.removeItem('currentClassStudents');
                return;
            }
            
            // Êü•ÊâæÁè≠Á∫ßÂ≠¶ÁîüÔºàÊîØÊåÅÂ§öÁßçÁè≠Á∫ßÊ†ºÂºèÔºâ
            const classStudents = studentsData.filter(student => {
                const studentClass = student['Áè≠Á∫ß'];
                if (!studentClass) return false;
                
                // ÊèêÂèñÁè≠Á∫ß‰∏≠ÁöÑÊï∞Â≠ó
                const classMatch = studentClass.toString().match(/(\d+)/);
                if (classMatch) {
                    return classMatch[1] === classNumber.toString();
                }
                return false;
            });
            
            if (classStudents.length === 0) {
                const seatingArrangement = document.getElementById('seatingArrangement');
                seatingArrangement.innerHTML = `
                    <div class="no-data">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Êú™ÊâæÂà∞Áè≠Á∫ß ${classNumber} ÁöÑÂ≠¶Áîü‰ø°ÊÅØ</p>
                    </div>
                `;
                document.getElementById('seatingStats').innerHTML = '';
                // Ê∏ÖÁ©∫Êú¨Âú∞Â≠òÂÇ®ÁöÑÁè≠Á∫ß‰ø°ÊÅØ
                localStorage.removeItem('currentClassStudents');
                return;
            }
            
            // ÊåâÁè≠Á∫ßÂ∫ßÂè∑ÊéíÂ∫è
            classStudents.sort((a, b) => {
                const seatA = parseInt(a['Áè≠Á∫ßÂ∫ßÂè∑'] || a['Â∫ß‰ΩçÂè∑'] || a['Â∫ßÂè∑'] || 0);
                const seatB = parseInt(b['Áè≠Á∫ßÂ∫ßÂè∑'] || b['Â∫ß‰ΩçÂè∑'] || b['Â∫ßÂè∑'] || 0);
                return seatA - seatB;
            });
            
            // ‰øùÂ≠òÁè≠Á∫ßÂ≠¶Áîü‰ø°ÊÅØÂà∞Êú¨Âú∞Â≠òÂÇ®
            const classInfo = {
                classNumber: classNumber,
                students: classStudents,
                timestamp: new Date().toISOString()
            };
            localStorage.setItem('currentClassStudents', JSON.stringify(classInfo));
            
            // Áõ¥Êé•ÊòæÁ§∫ÊâÄÊúâÂ≠¶Áîü‰ø°ÊÅØÔºå‰∏çÊåâÁªÑÊï∞ÂàÜÁªÑ
            const seatingArrangement = document.getElementById('seatingArrangement');
            let html = '<div class="class-students-grid">';
            
            classStudents.forEach(student => {
                const classSeatNumber = student['Áè≠Á∫ßÂ∫ßÂè∑'] || student['Â∫ßÂè∑'] || student['Â∫ß‰ΩçÂè∑'] || '';
                html += `
                    <div class="class-student-item">
                        ${classSeatNumber ? `<span class="class-seat-number">${classSeatNumber}</span>` : ''}
                        <span class="student-name">${student['ÂßìÂêç'] || 'Êú™Áü•'}</span>
                        <span class="exam-seat">${student['ËÄÉÂú∫'] || 'Êú™Áü•'}-${student['Â∫ßÂè∑'] || student['Â∫ß‰ΩçÂè∑'] || 'Êú™Áü•'}</span>
                    </div>
                `;
            });
            
            html += '</div>';
            seatingArrangement.innerHTML = html;
        }

        // ‰ªéÊú¨Âú∞Â≠òÂÇ®ÊÅ¢Â§çÁè≠Á∫ßÂ≠¶Áîü‰ø°ÊÅØ
        function loadClassStudentsFromStorage() {
            const saved = localStorage.getItem('currentClassStudents');
            if (!saved) return;
            
            try {
                const classInfo = JSON.parse(saved);
                
                // Ê£ÄÊü•Êï∞ÊçÆÊòØÂê¶ËøáÊúüÔºà24Â∞èÊó∂Ôºâ
                const savedTime = new Date(classInfo.timestamp);
                const now = new Date();
                const hoursDiff = (now - savedTime) / (1000 * 60 * 60);
                
                if (hoursDiff > 24) {
                    localStorage.removeItem('currentClassStudents');
                    return;
                }
                
                // Â¶ÇÊûúÊúâÂ≠¶ÁîüÊï∞ÊçÆÔºåÊÅ¢Â§çÊòæÁ§∫
                if (classInfo.students && classInfo.students.length > 0) {
                    // ËÆæÁΩÆÁè≠Á∫ßÂè∑ËæìÂÖ•Ê°Ü
                    const classInput = document.getElementById('classNumber');
                    if (classInput) {
                        classInput.value = classInfo.classNumber;
                    }
                    
                    // ËÆæÁΩÆÊü•ËØ¢ËæìÂÖ•Ê°Ü
                    const queryInput = document.getElementById('queryInput');
                    if (queryInput) {
                        queryInput.value = classInfo.classNumber;
                    }
                    
                    // Á°Æ‰øùÊü•ËØ¢Á±ªÂûãËÆæÁΩÆ‰∏∫Áè≠Á∫ß
                    const queryTypeSelect = document.getElementById('queryTypeSelect');
                    if (queryTypeSelect) {
                        queryTypeSelect.value = 'class';
                    }
                    
                    // ÊÅ¢Â§çÊòæÁ§∫
                    const seatingArrangement = document.getElementById('seatingArrangement');
                    let html = '<div class="class-students-grid">';
                    
                    classInfo.students.forEach(student => {
                        const classSeatNumber = student['Áè≠Á∫ßÂ∫ßÂè∑'] || student['Â∫ßÂè∑'] || student['Â∫ß‰ΩçÂè∑'] || '';
                        html += `
                            <div class="class-student-item">
                                ${classSeatNumber ? `<span class="class-seat-number">${classSeatNumber}</span>` : ''}
                                <span class="student-name">${student['ÂßìÂêç'] || 'Êú™Áü•'}</span>
                                <span class="exam-seat">${student['ËÄÉÂú∫'] || 'Êú™Áü•'}-${student['Â∫ßÂè∑'] || student['Â∫ß‰ΩçÂè∑'] || 'Êú™Áü•'}</span>
                            </div>
                        `;
                    });
                    
                    html += '</div>';
                    seatingArrangement.innerHTML = html;
                    
                    // showSeatingNotification(`Â∑≤ÊÅ¢Â§çÁè≠Á∫ß ${classInfo.classNumber} ÁöÑÂ≠¶Áîü‰ø°ÊÅØ`, 'success');
                }
            } catch (error) {
                console.error('ÊÅ¢Â§çÁè≠Á∫ß‰ø°ÊÅØÂ§±Ë¥•:', error);
                localStorage.removeItem('currentClassStudents');
            }
        }

        // ‰ªéÊú¨Âú∞Â≠òÂÇ®ÊÅ¢Â§çËÄÉÂú∫‰ø°ÊÅØ
        function loadExamRoomFromStorage() {
            const saved = localStorage.getItem('currentExamRoomInfo');
            if (!saved) return;
            
            try {
                const examRoomInfo = JSON.parse(saved);
                
                // Ê£ÄÊü•Êï∞ÊçÆÊòØÂê¶ËøáÊúüÔºà24Â∞èÊó∂Ôºâ
                const savedTime = new Date(examRoomInfo.timestamp);
                const now = new Date();
                const hoursDiff = (now - savedTime) / (1000 * 60 * 60);
                
                if (hoursDiff > 24) {
                    localStorage.removeItem('currentExamRoomInfo');
                    return;
                }
                
                // Â¶ÇÊûúÊúâËÄÉÂú∫Êï∞ÊçÆÔºåÊÅ¢Â§çÊòæÁ§∫
                if (examRoomInfo.examRoom && examRoomInfo.students && examRoomInfo.students.length > 0) {
                    // ËÆæÁΩÆÊü•ËØ¢ËæìÂÖ•Ê°Ü
                    const queryInput = document.getElementById('queryInput');
                    if (queryInput) {
                        queryInput.value = examRoomInfo.examRoom;
                    }
                    
                    // Á°Æ‰øùÊü•ËØ¢Á±ªÂûãËÆæÁΩÆ‰∏∫ËÄÉÂú∫
                    const queryTypeSelect = document.getElementById('queryTypeSelect');
                    if (queryTypeSelect) {
                        queryTypeSelect.value = 'examRoom';
                    }
                    
                    // ËÆæÁΩÆÂΩìÂâçËÄÉÂú∫
                    currentExamRoom = examRoomInfo.examRoom;
                    
                    // ÊÅ¢Â§çÂ∫ß‰ΩçÂÆâÊéíÊòæÁ§∫
                    const groupCount = parseInt(document.getElementById('groupCount').value) || 5;
                    const groupSizesInput = document.getElementById('groupSizes').value.trim();
                    let groupSizes = [];
                    
                    if (groupSizesInput) {
                        groupSizes = groupSizesInput.split(',').map(size => parseInt(size.trim()) || 6);
                        while (groupSizes.length < groupCount) {
                            groupSizes.push(6);
                        }
                        groupSizes = groupSizes.slice(0, groupCount);
                    } else {
                        for (let i = 0; i < groupCount; i++) {
                            groupSizes.push(6);
                        }
                    }
                    
                    const seatingGroups = generateSShapeArrangementWithCustomSizes(examRoomInfo.students, groupSizes);
                    renderSeatingArrangement(seatingGroups);
                    
                    // showSeatingNotification(`Â∑≤ÊÅ¢Â§çËÄÉÂú∫ ${examRoomInfo.examRoom} ÁöÑÂ∫ß‰ΩçÂÆâÊéí`, 'success');
                }
            } catch (error) {
                console.error('ÊÅ¢Â§çËÄÉÂú∫‰ø°ÊÅØÂ§±Ë¥•:', error);
                localStorage.removeItem('currentExamRoomInfo');
            }
        }

        function updateSeatingArrangement() {
            const seatingArrangement = document.getElementById('seatingArrangement');
            const seatingStats = document.getElementById('seatingStats');
            
            if (!studentsData.length || !currentExamRoom) {
                seatingArrangement.innerHTML = `
                    <div class="no-data">
                        <i class="fas fa-users"></i>
                        <p>${!studentsData.length ? 'ËØ∑ÂÖàÂØºÂÖ•ExcelÊñá‰ª∂' : 'ËØ∑ËæìÂÖ•ËÄÉÂú∫Âè∑'}</p>
                    </div>
                `;
                seatingStats.innerHTML = '';
                // Ê∏ÖÁ©∫ËÄÉÂú∫‰ø°ÊÅØÂ≠òÂÇ®
                localStorage.removeItem('currentExamRoomInfo');
                return;
            }
            
            const roomStudents = studentsData.filter(student => 
                student['ËÄÉÂú∫'] && student['ËÄÉÂú∫'].toString() === currentExamRoom
            );
            
            if (roomStudents.length === 0) {
                seatingArrangement.innerHTML = `
                    <div class="no-data">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>ËÄÉÂú∫ ${currentExamRoom} Ê≤°ÊúâÊâæÂà∞Â≠¶ÁîüÊï∞ÊçÆ</p>
                    </div>
                `;
                seatingStats.innerHTML = '';
                // Ê∏ÖÁ©∫ËÄÉÂú∫‰ø°ÊÅØÂ≠òÂÇ®
                localStorage.removeItem('currentExamRoomInfo');
                return;
            }
            
            roomStudents.sort((a, b) => {
                const seatA = parseInt(a['Â∫ßÂè∑']) || 0;
                const seatB = parseInt(b['Â∫ßÂè∑']) || 0;
                return seatA - seatB;
            });
            
            const groupCount = parseInt(document.getElementById('groupCount').value) || 5;
            const groupSizesInput = document.getElementById('groupSizes').value.trim();
            let groupSizes = [];
            
            if (groupSizesInput) {
                groupSizes = groupSizesInput.split(',').map(size => parseInt(size.trim()) || 6);
                while (groupSizes.length < groupCount) {
                    groupSizes.push(6);
                }
                groupSizes = groupSizes.slice(0, groupCount);
            } else {
                for (let i = 0; i < groupCount; i++) {
                    groupSizes.push(6);
                }
            }
            
            const seatingGroups = generateSShapeArrangementWithCustomSizes(roomStudents, groupSizes);
            saveSeatingResult(seatingGroups);
            seatingStats.innerHTML = '';
            renderSeatingArrangement(seatingGroups);
            
            // ‰øùÂ≠òËÄÉÂú∫‰ø°ÊÅØÂà∞Êú¨Âú∞Â≠òÂÇ®
            const examRoomInfo = {
                examRoom: currentExamRoom,
                students: roomStudents,
                timestamp: new Date().toISOString()
            };
            localStorage.setItem('currentExamRoomInfo', JSON.stringify(examRoomInfo));
        }

        function generateSShapeArrangementWithCustomSizes(students, groupSizes) {
            const groups = [];
            let studentIndex = 0;
            
            for (let groupIndex = 0; groupIndex < groupSizes.length && studentIndex < students.length; groupIndex++) {
                const group = {
                    id: groupIndex + 1,
                    students: []
                };
                
                const currentGroupSize = Math.min(groupSizes[groupIndex], students.length - studentIndex);
                const groupStudents = students.slice(studentIndex, studentIndex + currentGroupSize);
                
                if (groupIndex % 2 === 0) {
                    group.students = groupStudents;
                } else {
                    group.students = groupStudents.reverse();
                }
                
                groups.push(group);
                studentIndex += currentGroupSize;
            }
            
            return groups;
        }

        function renderSeatingArrangement(groups) {
            const seatingArrangement = document.getElementById('seatingArrangement');
            
            let html = '<div class="seating-grid">';
            
            groups.forEach(group => {
                html += `
                    <div class="seating-group">
                        <div class="group-header">Á¨¨ ${group.id} ÁªÑ</div>
                        <div class="seats-container">
                `;
                
                group.students.forEach(student => {
                    html += `
                        <div class="seat">
                            <div class="seat-number">${student['Â∫ßÂè∑'] || 'Êú™Áü•'}</div>
                            <div class="student-name">${student['ÂßìÂêç'] || 'Êú™Áü•'}</div>
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            seatingArrangement.innerHTML = html;
        }

        function showSeatingNotification(message, type = 'success') {
            const existingNotification = document.querySelector('.seating-notification');
            if (existingNotification) {
                existingNotification.remove();
            }
            
            const notification = document.createElement('div');
            notification.className = `seating-notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // ÈîÅÂÆöÂäüËÉΩÁõ∏ÂÖ≥ÂèòÈáèÂíåÂáΩÊï∞
        let isLocked = true; // ÈªòËÆ§ÈîÅÂÆöÁä∂ÊÄÅ
        const unlockPassword = '456123'; // ÈªòËÆ§ÂØÜÁ†Å

        // ÂàùÂßãÂåñÈîÅÂÆöÁä∂ÊÄÅ
        function initializeLockState() {
            updateLockState();
        }

        // Êõ¥Êñ∞ÈîÅÂÆöÁä∂ÊÄÅ
        function updateLockState() {
            const lockBtn = document.getElementById('lockBtn');
            const lockIcon = lockBtn.querySelector('i');
            
            // Ëé∑ÂèñÊâÄÊúâÈúÄË¶ÅÈîÅÂÆöÁöÑÊåâÈíÆÔºàÈô§‰∫ÜÂèåÂêëÂàáÊç¢„ÄÅÂ∏ÆÂä©„ÄÅÂÖ®Â±è„ÄÅÂ§úÈó¥Ê®°Âºè„ÄÅÁº©ÊîæÂíåÈîÅÂÆöÊåâÈíÆÊú¨Ë∫´Ôºâ
            const buttonsToLock = document.querySelectorAll('.control-btn:not(#pageToggleBtn):not(#lockBtn)');
            const helpBtn = document.querySelector('.control-btn[onclick="showHelp()"]');
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            const darkModeBtn = document.getElementById('darkModeBtn');
            const zoomInBtn = document.querySelector('.control-btn[onclick="zoomIn()"]');
            const zoomOutBtn = document.querySelector('.control-btn[onclick="zoomOut()"]');
            
            // Ëé∑ÂèñÂØºÂÖ•ÈÖçÁΩÆÊåâÈíÆÔºàlabelÂÖÉÁ¥†ÔºâÂíåÂÖ∂ÂÜÖÈÉ®ÁöÑÊñá‰ª∂ËæìÂÖ•
            const importConfigLabel = document.querySelector('label.control-btn[title="ÂØºÂÖ•ÈÖçÁΩÆ"]');
            const importConfigInput = importConfigLabel ? importConfigLabel.querySelector('input[type="file"]') : null;
            
            // Ëé∑ÂèñËÄÉËØïÁÆ°ÁêÜÂíåÊèêÈÜíËÆæÁΩÆ‰∏≠ÁöÑÊâÄÊúâÊåâÈíÆ
            const examManagementButtons = document.querySelectorAll('.btn[onclick*="Exam"], .btn[onclick*="addExam"], .btn[onclick*="editExam"], .btn[onclick*="deleteExam"]');
            const reminderManagementButtons = document.querySelectorAll('.btn[onclick*="Reminder"], .btn[onclick*="addReminder"], .btn[onclick*="editReminder"], .btn[onclick*="deleteReminder"], .btn[onclick*="toggleReminder"]');
            
            // Ëé∑ÂèñÂ∫ß‰ΩçÂÆâÊéí‰∏≠ÁöÑÂØºÂÖ•Êï∞ÊçÆÂíåÊ∏ÖÈô§Êï∞ÊçÆÊåâÈíÆ
            const seatingImportBtn = document.querySelector('.import-btn');
            const seatingClearBtn = document.querySelector('.clear-data-btn');
            
            if (isLocked) {
                // ÈîÅÂÆöÁä∂ÊÄÅ
                lockIcon.className = 'fas fa-lock';
                lockBtn.title = 'Ëß£ÈîÅ';
                
                // ÈîÅÂÆöÈô§‰∫ÜÂèåÂêëÂàáÊç¢„ÄÅÂ∏ÆÂä©„ÄÅÂÖ®Â±è„ÄÅÂ§úÈó¥Ê®°Âºè„ÄÅÁº©ÊîæÊåâÈíÆÂ§ñÁöÑÊâÄÊúâÊåâÈíÆ
                buttonsToLock.forEach(btn => {
                    if (btn !== helpBtn && btn !== fullscreenBtn && btn !== darkModeBtn && btn !== zoomInBtn && btn !== zoomOutBtn && btn !== importConfigLabel) {
                        btn.style.opacity = '0.5';
                        btn.style.cursor = 'not-allowed';
                        btn.style.pointerEvents = 'none';
                    }
                });
                
                // ÁâπÂà´Â§ÑÁêÜÂØºÂÖ•ÈÖçÁΩÆÊåâÈíÆ
                if (importConfigLabel) {
                    importConfigLabel.style.opacity = '0.5';
                    importConfigLabel.style.cursor = 'not-allowed';
                    importConfigLabel.style.pointerEvents = 'none';
                }
                if (importConfigInput) {
                    importConfigInput.disabled = true;
                }
                
                // ÈîÅÂÆöËÄÉËØïÁÆ°ÁêÜÊåâÈíÆ
                examManagementButtons.forEach(btn => {
                    btn.style.opacity = '0.5';
                    btn.style.cursor = 'not-allowed';
                    btn.style.pointerEvents = 'none';
                });
                
                // ÈîÅÂÆöÊèêÈÜíËÆæÁΩÆÊåâÈíÆ
                reminderManagementButtons.forEach(btn => {
                    btn.style.opacity = '0.5';
                    btn.style.cursor = 'not-allowed';
                    btn.style.pointerEvents = 'none';
                });
                
                // ÈîÅÂÆöÂ∫ß‰ΩçÂÆâÊéíÊåâÈíÆ
                if (seatingImportBtn) {
                    seatingImportBtn.style.opacity = '0.5';
                    seatingImportBtn.style.cursor = 'not-allowed';
                    seatingImportBtn.style.pointerEvents = 'none';
                }
                if (seatingClearBtn) {
                    seatingClearBtn.style.opacity = '0.5';
                    seatingClearBtn.style.cursor = 'not-allowed';
                    seatingClearBtn.style.pointerEvents = 'none';
                }
            } else {
                // Ëß£ÈîÅÁä∂ÊÄÅ
                lockIcon.className = 'fas fa-unlock';
                lockBtn.title = 'ÈîÅÂÆö';
                
                // Ëß£ÈîÅÊâÄÊúâÊåâÈíÆ
                buttonsToLock.forEach(btn => {
                    btn.disabled = false;
                    btn.style.opacity = '';
                    btn.style.cursor = '';
                    btn.style.pointerEvents = '';
                });
                
                // ÁâπÂà´Â§ÑÁêÜÂØºÂÖ•ÈÖçÁΩÆÊåâÈíÆ
                if (importConfigLabel) {
                    importConfigLabel.style.opacity = '';
                    importConfigLabel.style.cursor = '';
                    importConfigLabel.style.pointerEvents = '';
                }
                if (importConfigInput) {
                    importConfigInput.disabled = false;
                }
                
                // Ëß£ÈîÅËÄÉËØïÁÆ°ÁêÜÊåâÈíÆ
                examManagementButtons.forEach(btn => {
                    btn.disabled = false;
                    btn.style.opacity = '';
                    btn.style.cursor = '';
                    btn.style.pointerEvents = '';
                });
                
                // Ëß£ÈîÅÊèêÈÜíËÆæÁΩÆÊåâÈíÆ
                reminderManagementButtons.forEach(btn => {
                    btn.disabled = false;
                    btn.style.opacity = '';
                    btn.style.cursor = '';
                    btn.style.pointerEvents = '';
                });
                
                // Ëß£ÈîÅÂ∫ß‰ΩçÂÆâÊéíÊåâÈíÆ
                if (seatingImportBtn) {
                    seatingImportBtn.style.opacity = '';
                    seatingImportBtn.style.cursor = '';
                    seatingImportBtn.style.pointerEvents = '';
                }
                if (seatingClearBtn) {
                    seatingClearBtn.disabled = false;
                    seatingClearBtn.style.opacity = '';
                    seatingClearBtn.style.cursor = '';
                    seatingClearBtn.style.pointerEvents = '';
                }
            }
        }

        // ÂàáÊç¢ÈîÅÂÆöÁä∂ÊÄÅ
        function toggleLock() {
            if (isLocked) {
                isLocked = false;
                updateLockState();
                showNotification('Â∑≤Ëß£ÈîÅ', 'success');
            } else {
                isLocked = true;
                updateLockState();
                showNotification('Â∑≤ÈîÅÂÆö', 'success');
            }
        }

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñÈîÅÂÆöÁä∂ÊÄÅ
        document.addEventListener('DOMContentLoaded', function() {
            // Âª∂ËøüÂàùÂßãÂåñÔºåÁ°Æ‰øùÊâÄÊúâÊåâÈíÆÈÉΩÂ∑≤Âä†ËΩΩ
            setTimeout(initializeLockState, 100);
        });

        // Ê£ÄÊü•Êú¨Âú∫ÂÖ®ÈÉ®ËÄÉËØïÊòØÂê¶Â∑≤ÁªìÊùü
        function checkAllExamsEndedForToday(endedExam) {
            const now = new Date();
            const today = now.toISOString().split('T')[0];
            const allInstances = getAllExamInstances();
            
            // Ëé∑Âèñ‰ªäÂ§©ÁöÑÊâÄÊúâËÄÉËØï
            const todayExams = allInstances.filter(exam => exam.date === today);
            
            if (todayExams.length === 0) {
                return; // ‰ªäÂ§©Ê≤°ÊúâËÄÉËØï
            }
            
            // Ê£ÄÊü•‰ªäÂ§©ÊâÄÊúâËÄÉËØïÊòØÂê¶ÈÉΩÂ∑≤ÁªìÊùü
            const allExamsEnded = todayExams.every(exam => {
                const examStart = new Date(`${exam.date} ${exam.startTime}`);
                const examEnd = new Date(examStart.getTime() + exam.duration * 60000);
                return now >= examEnd;
            });
            
            if (allExamsEnded) {
                console.log('Êú¨Âú∫ÂÖ®ÈÉ®ËÄÉËØïÂ∑≤ÁªìÊùüÔºåÂáÜÂ§áÊÅ¢Â§çÂ∫ß‰ΩçÂÆâÊéíÊï∞ÊçÆ');
                restoreSeatingDataAfterExams();
            }
        }

        // Âú®ËÄÉËØïÂÖ®ÈÉ®ÁªìÊùüÂêéÊÅ¢Â§çÂ∫ß‰ΩçÂÆâÊéíÊï∞ÊçÆ
        function restoreSeatingDataAfterExams() {
            const savedData = localStorage.getItem('studentsData');
            const importTime = localStorage.getItem('studentsDataImportTime');
            
            if (savedData && importTime) {
                try {
                    const data = JSON.parse(savedData);
                    const importDate = new Date(importTime);
                    const now = new Date();
                    
                    // Ê£ÄÊü•Êï∞ÊçÆÊòØÂê¶ÊòØ‰ªäÂ§©ÂØºÂÖ•ÁöÑ
                    const isToday = importDate.toDateString() === now.toDateString();
                    
                    if (isToday && Array.isArray(data) && data.length > 0) {
                        studentsData = data;
                        showSeatingNotification(`ËÄÉËØïÁªìÊùüÔºåÂ∑≤ÊÅ¢Â§çËÄÉÂú∫ÂÆâÊéíÊï∞ÊçÆÔºö${data.length} Êù°Â≠¶ÁîüËÆ∞ÂΩï`);
                        
                        // Â¶ÇÊûúÂΩìÂâçÂú®Â∫ß‰ΩçÂÆâÊéíÈ°µÈù¢ÔºåÊõ¥Êñ∞ÊòæÁ§∫
                        if (document.body.classList.contains('seating-page')) {
                            updateSeatingArrangement();
                        }
                        
                        console.log('Â∫ß‰ΩçÂÆâÊéíÊï∞ÊçÆÂ∑≤ÊÅ¢Â§ç');
                    } else {
                        console.log('Â∫ß‰ΩçÂÆâÊéíÊï∞ÊçÆ‰∏çÊòØ‰ªäÂ§©ÂØºÂÖ•ÁöÑÔºå‰∏çËøõË°åÊÅ¢Â§ç');
                    }
                } catch (error) {
                    console.error('ÊÅ¢Â§çÂ∫ß‰ΩçÂÆâÊéíÊï∞ÊçÆÂ§±Ë¥•:', error);
                }
            } else {
                console.log('Ê≤°ÊúâÊâæÂà∞ÈúÄË¶ÅÊÅ¢Â§çÁöÑÂ∫ß‰ΩçÂÆâÊéíÊï∞ÊçÆ');
            }
        }
    </script>
    
    <!-- ÂºïÂÖ•XLSXÂ∫ì -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</body>
</html>
